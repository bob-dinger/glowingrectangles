<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Verb Clusters (with Icons)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #888;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }
        #canvas {
            background-color: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
        }
        .category-list {
            background-color: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            width: 240px;
            max-height: 600px;
            overflow-y: auto;
        }
        .category-list h2 {
            font-size: 14px;
            margin-bottom: 15px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .category-item {
            padding: 10px 12px;
            margin-bottom: 8px;
            background-color: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .category-item:hover {
            background-color: #2a2a2a;
            border-color: #555;
        }
        .category-item.selected {
            border-color: var(--cat-color);
            background-color: #1a1a1a;
        }
        .category-item .icon-container {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .category-item .icon-container img {
            width: 20px;
            height: 20px;
        }
        .category-item .icon-container.loading {
            background: #252525;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        .category-item .emoji {
            font-size: 18px;
        }
        .category-item .name {
            flex: 1;
        }
        .category-item .count {
            color: #555;
            font-size: 11px;
        }
        .info {
            margin-top: 20px;
            font-size: 12px;
            color: #666;
            text-align: center;
            max-width: 600px;
        }
        .loading-status {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            color: #888;
            border: 1px solid #333;
        }
        .verb-label {
            font-size: 14px;
            font-weight: bold;
            fill: #fff;
            pointer-events: none;
            text-anchor: middle;
        }
        .verb-english {
            font-size: 11px;
            fill: #aaa;
            pointer-events: none;
            text-anchor: middle;
        }
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.95);
            border: 1px solid #444;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 280px;
            z-index: 100;
        }
        .tooltip .spanish {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .tooltip .english {
            color: #aaa;
            margin-bottom: 8px;
        }
        .tooltip .example {
            font-style: italic;
            color: #888;
            font-size: 12px;
            border-top: 1px solid #333;
            padding-top: 8px;
            margin-top: 4px;
        }
        .tooltip .example-trans {
            color: #666;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>Spanish Verb Clusters</h1>
    <p class="subtitle">Related verbs grouped by action type â€” with dynamic icons!</p>

    <div class="container">
        <div>
            <svg id="canvas" width="650" height="600"></svg>
            <div class="info">Click a verb to hear pronunciation â€¢ Hover for examples</div>
        </div>

        <div class="category-list">
            <h2>Categories</h2>
            <div id="categories"></div>
        </div>
    </div>
    <div class="tooltip"></div>
    <div id="loadingStatus" class="loading-status">Loading icons...</div>

    <script src="freepik-api.js"></script>
    <script>
        const width = 650;
        const height = 600;

        // Categories with icon search terms
        const categories = {
            mouth: {
                name: 'Mouth Actions',
                emoji: 'ðŸ‘„',
                iconSearch: 'lips mouth',
                color: '#EF4444',
                verbs: [
                    { spanish: 'gritar', english: 'to shout', example: 'Â¡No me grites!', exampleEn: "Don't shout at me!" },
                    { spanish: 'susurrar', english: 'to whisper', example: 'Me susurrÃ³ un secreto', exampleEn: 'She whispered a secret to me' },
                    { spanish: 'soplar', english: 'to blow', example: 'Sopla las velas', exampleEn: 'Blow out the candles' },
                    { spanish: 'escupir', english: 'to spit', example: 'No escupas en el suelo', exampleEn: "Don't spit on the floor" },
                    { spanish: 'silbar', english: 'to whistle', example: 'Ã‰l silba una canciÃ³n', exampleEn: 'He whistles a song' },
                    { spanish: 'besar', english: 'to kiss', example: 'La besÃ³ en la mejilla', exampleEn: 'He kissed her on the cheek' },
                    { spanish: 'morder', english: 'to bite', example: 'El perro me mordiÃ³', exampleEn: 'The dog bit me' },
                    { spanish: 'lamer', english: 'to lick', example: 'El gato lame su pata', exampleEn: 'The cat licks its paw' },
                    { spanish: 'chupar', english: 'to suck', example: 'El bebÃ© chupa su dedo', exampleEn: 'The baby sucks its thumb' },
                    { spanish: 'masticar', english: 'to chew', example: 'Mastica bien la comida', exampleEn: 'Chew your food well' },
                    { spanish: 'tragar', english: 'to swallow', example: 'Traga la pastilla', exampleEn: 'Swallow the pill' }
                ]
            },
            throwing: {
                name: 'Throwing',
                emoji: 'ðŸŽ¯',
                iconSearch: 'throw ball',
                color: '#3B82F6',
                verbs: [
                    { spanish: 'lanzar', english: 'to throw/launch', example: 'LanzÃ³ la pelota', exampleEn: 'He threw the ball' },
                    { spanish: 'tirar', english: 'to throw/pull', example: 'Tira la basura', exampleEn: 'Throw away the trash' },
                    { spanish: 'arrojar', english: 'to hurl/fling', example: 'ArrojÃ³ piedras al agua', exampleEn: 'He hurled stones into the water' },
                    { spanish: 'echar', english: 'to throw/pour', example: 'Ã‰chame la pelota', exampleEn: 'Throw me the ball' },
                    { spanish: 'aventar', english: 'to throw (Mexico)', example: 'AviÃ©ntame las llaves', exampleEn: 'Toss me the keys' },
                    { spanish: 'botar', english: 'to bounce/throw out', example: 'Bota la pelota', exampleEn: 'Bounce the ball' },
                    { spanish: 'disparar', english: 'to shoot/fire', example: 'DisparÃ³ una flecha', exampleEn: 'He shot an arrow' }
                ]
            },
            looking: {
                name: 'Looking & Seeing',
                emoji: 'ðŸ‘ï¸',
                iconSearch: 'eye vision',
                color: '#8B5CF6',
                verbs: [
                    { spanish: 'mirar', english: 'to look at', example: 'MÃ­rame a los ojos', exampleEn: 'Look me in the eyes' },
                    { spanish: 'ver', english: 'to see', example: 'Â¿Ves eso?', exampleEn: 'Do you see that?' },
                    { spanish: 'observar', english: 'to observe', example: 'Observa las estrellas', exampleEn: 'Observe the stars' },
                    { spanish: 'vigilar', english: 'to watch/guard', example: 'Vigila a los niÃ±os', exampleEn: 'Watch the children' },
                    { spanish: 'espiar', english: 'to spy', example: 'Lo estaban espiando', exampleEn: 'They were spying on him' },
                    { spanish: 'contemplar', english: 'to contemplate', example: 'Contempla el paisaje', exampleEn: 'Contemplate the landscape' },
                    { spanish: 'ojear', english: 'to glance at', example: 'OjeÃ³ el periÃ³dico', exampleEn: 'He glanced at the newspaper' },
                    { spanish: 'divisar', english: 'to make out/spot', example: 'DivisÃ© un barco', exampleEn: 'I spotted a ship' },
                    { spanish: 'avistar', english: 'to sight/spot', example: 'Avistaron tierra', exampleEn: 'They sighted land' }
                ]
            },
            hands: {
                name: 'Hand Actions',
                emoji: 'âœ‹',
                iconSearch: 'hand gesture',
                color: '#22C55E',
                verbs: [
                    { spanish: 'agarrar', english: 'to grab', example: 'Agarra mi mano', exampleEn: 'Grab my hand' },
                    { spanish: 'coger', english: 'to take/grab (Spain)', example: 'Coge el libro', exampleEn: 'Take the book' },
                    { spanish: 'tomar', english: 'to take', example: 'Toma asiento', exampleEn: 'Take a seat' },
                    { spanish: 'soltar', english: 'to let go/release', example: 'Â¡SuÃ©ltame!', exampleEn: 'Let me go!' },
                    { spanish: 'apretar', english: 'to squeeze/press', example: 'Aprieta el botÃ³n', exampleEn: 'Press the button' },
                    { spanish: 'empujar', english: 'to push', example: 'Empuja la puerta', exampleEn: 'Push the door' },
                    { spanish: 'jalar', english: 'to pull (LatAm)', example: 'Jala la cuerda', exampleEn: 'Pull the rope' },
                    { spanish: 'tocar', english: 'to touch', example: 'No toques eso', exampleEn: "Don't touch that" },
                    { spanish: 'frotar', english: 'to rub', example: 'Frota tus manos', exampleEn: 'Rub your hands' },
                    { spanish: 'rascar', english: 'to scratch', example: 'Me rasco la cabeza', exampleEn: 'I scratch my head' },
                    { spanish: 'pellizcar', english: 'to pinch', example: 'Me pellizcÃ³ el brazo', exampleEn: 'She pinched my arm' }
                ]
            },
            movement: {
                name: 'Movement',
                emoji: 'ðŸƒ',
                iconSearch: 'running person',
                color: '#F59E0B',
                verbs: [
                    { spanish: 'caminar', english: 'to walk', example: 'Camino al trabajo', exampleEn: 'I walk to work' },
                    { spanish: 'correr', english: 'to run', example: 'Corre mÃ¡s rÃ¡pido', exampleEn: 'Run faster' },
                    { spanish: 'saltar', english: 'to jump', example: 'Salta la cuerda', exampleEn: 'Jump rope' },
                    { spanish: 'trepar', english: 'to climb', example: 'Trepa el Ã¡rbol', exampleEn: 'Climb the tree' },
                    { spanish: 'arrastrarse', english: 'to crawl', example: 'El bebÃ© se arrastra', exampleEn: 'The baby crawls' },
                    { spanish: 'gatear', english: 'to crawl (on all fours)', example: 'Gatea por el suelo', exampleEn: 'Crawl on the floor' },
                    { spanish: 'tropezar', english: 'to trip/stumble', example: 'TropecÃ© con una piedra', exampleEn: 'I tripped on a rock' },
                    { spanish: 'resbalar', english: 'to slip', example: 'ResbalÃ© en el hielo', exampleEn: 'I slipped on the ice' },
                    { spanish: 'tambalearse', english: 'to stagger', example: 'Se tambaleÃ³ borracho', exampleEn: 'He staggered drunk' }
                ]
            },
            speaking: {
                name: 'Speaking',
                emoji: 'ðŸ’¬',
                iconSearch: 'speech bubble talk',
                color: '#EC4899',
                verbs: [
                    { spanish: 'hablar', english: 'to speak', example: 'Habla mÃ¡s despacio', exampleEn: 'Speak more slowly' },
                    { spanish: 'decir', english: 'to say/tell', example: 'Â¿QuÃ© dijiste?', exampleEn: 'What did you say?' },
                    { spanish: 'contar', english: 'to tell (a story)', example: 'CuÃ©ntame un cuento', exampleEn: 'Tell me a story' },
                    { spanish: 'explicar', english: 'to explain', example: 'ExplÃ­camelo otra vez', exampleEn: 'Explain it to me again' },
                    { spanish: 'preguntar', english: 'to ask', example: 'PregÃºntale su nombre', exampleEn: 'Ask him his name' },
                    { spanish: 'responder', english: 'to answer', example: 'Responde mi pregunta', exampleEn: 'Answer my question' },
                    { spanish: 'murmurar', english: 'to murmur', example: 'MurmurÃ³ algo', exampleEn: 'He murmured something' },
                    { spanish: 'charlar', english: 'to chat', example: 'Charlamos toda la noche', exampleEn: 'We chatted all night' },
                    { spanish: 'discutir', english: 'to argue/discuss', example: 'Discutieron por dinero', exampleEn: 'They argued about money' },
                    { spanish: 'confesar', english: 'to confess', example: 'ConfesÃ³ su amor', exampleEn: 'He confessed his love' }
                ]
            },
            breaking: {
                name: 'Breaking & Cutting',
                emoji: 'ðŸ’¥',
                iconSearch: 'scissors cut',
                color: '#F97316',
                verbs: [
                    { spanish: 'romper', english: 'to break', example: 'RompÃ­ el vaso', exampleEn: 'I broke the glass' },
                    { spanish: 'cortar', english: 'to cut', example: 'Corta el pan', exampleEn: 'Cut the bread' },
                    { spanish: 'partir', english: 'to split/break', example: 'Parte la manzana en dos', exampleEn: 'Split the apple in two' },
                    { spanish: 'rasgar', english: 'to tear/rip', example: 'RasgÃ³ el papel', exampleEn: 'He tore the paper' },
                    { spanish: 'destrozar', english: 'to destroy', example: 'DestrozÃ³ todo', exampleEn: 'He destroyed everything' },
                    { spanish: 'aplastar', english: 'to crush/smash', example: 'AplastÃ³ la lata', exampleEn: 'He crushed the can' },
                    { spanish: 'picar', english: 'to chop/mince', example: 'Pica la cebolla', exampleEn: 'Chop the onion' },
                    { spanish: 'rebanar', english: 'to slice', example: 'Rebana el jamÃ³n', exampleEn: 'Slice the ham' }
                ]
            },
            emotions: {
                name: 'Emotions',
                emoji: 'â¤ï¸',
                iconSearch: 'heart love',
                color: '#DC2626',
                verbs: [
                    { spanish: 'amar', english: 'to love', example: 'Te amo', exampleEn: 'I love you' },
                    { spanish: 'querer', english: 'to want/love', example: 'Te quiero mucho', exampleEn: 'I love you a lot' },
                    { spanish: 'odiar', english: 'to hate', example: 'Odio las mentiras', exampleEn: 'I hate lies' },
                    { spanish: 'temer', english: 'to fear', example: 'Temo lo peor', exampleEn: 'I fear the worst' },
                    { spanish: 'envidiar', english: 'to envy', example: 'Envidia su Ã©xito', exampleEn: 'She envies his success' },
                    { spanish: 'extraÃ±ar', english: 'to miss', example: 'Te extraÃ±o', exampleEn: 'I miss you' },
                    { spanish: 'desear', english: 'to desire/wish', example: 'Deseo verte', exampleEn: 'I wish to see you' },
                    { spanish: 'detestar', english: 'to detest', example: 'Detesto la injusticia', exampleEn: 'I detest injustice' },
                    { spanish: 'adorar', english: 'to adore', example: 'Adoro el chocolate', exampleEn: 'I adore chocolate' }
                ]
            },
            thinking: {
                name: 'Thinking',
                emoji: 'ðŸ§ ',
                iconSearch: 'brain think',
                color: '#6366F1',
                verbs: [
                    { spanish: 'pensar', english: 'to think', example: 'Pienso en ti', exampleEn: "I'm thinking of you" },
                    { spanish: 'creer', english: 'to believe', example: 'No te creo', exampleEn: "I don't believe you" },
                    { spanish: 'recordar', english: 'to remember', example: 'Recuerdo ese dÃ­a', exampleEn: 'I remember that day' },
                    { spanish: 'olvidar', english: 'to forget', example: 'OlvidÃ© mi contraseÃ±a', exampleEn: 'I forgot my password' },
                    { spanish: 'imaginar', english: 'to imagine', example: 'Imagina un mundo mejor', exampleEn: 'Imagine a better world' },
                    { spanish: 'soÃ±ar', english: 'to dream', example: 'SoÃ±Ã© contigo', exampleEn: 'I dreamed about you' },
                    { spanish: 'dudar', english: 'to doubt', example: 'Dudo que venga', exampleEn: 'I doubt he will come' },
                    { spanish: 'suponer', english: 'to suppose', example: 'Supongo que sÃ­', exampleEn: 'I suppose so' },
                    { spanish: 'razonar', english: 'to reason', example: 'Razona antes de actuar', exampleEn: 'Reason before you act' },
                    { spanish: 'reflexionar', english: 'to reflect', example: 'Reflexiona sobre tu vida', exampleEn: 'Reflect on your life' }
                ]
            },
            cleaning: {
                name: 'Cleaning',
                emoji: 'ðŸ§¹',
                iconSearch: 'broom clean',
                color: '#14B8A6',
                verbs: [
                    { spanish: 'limpiar', english: 'to clean', example: 'Limpia tu cuarto', exampleEn: 'Clean your room' },
                    { spanish: 'lavar', english: 'to wash', example: 'Lava los platos', exampleEn: 'Wash the dishes' },
                    { spanish: 'barrer', english: 'to sweep', example: 'Barre el piso', exampleEn: 'Sweep the floor' },
                    { spanish: 'fregar', english: 'to scrub', example: 'Friega la olla', exampleEn: 'Scrub the pot' },
                    { spanish: 'secar', english: 'to dry', example: 'Seca los platos', exampleEn: 'Dry the dishes' },
                    { spanish: 'planchar', english: 'to iron', example: 'Plancha la camisa', exampleEn: 'Iron the shirt' },
                    { spanish: 'sacudir', english: 'to dust/shake', example: 'Sacude las sÃ¡banas', exampleEn: 'Shake out the sheets' },
                    { spanish: 'trapear', english: 'to mop', example: 'Trapea el piso', exampleEn: 'Mop the floor' },
                    { spanish: 'recoger', english: 'to pick up/tidy', example: 'Recoge tus cosas', exampleEn: 'Pick up your things' }
                ]
            },
            cooking: {
                name: 'Cooking',
                emoji: 'ðŸ‘¨â€ðŸ³',
                iconSearch: 'cooking chef',
                color: '#F59E0B',
                verbs: [
                    { spanish: 'cocinar', english: 'to cook', example: 'Cocino para mi familia', exampleEn: 'I cook for my family' },
                    { spanish: 'hervir', english: 'to boil', example: 'Hierve el agua', exampleEn: 'Boil the water' },
                    { spanish: 'freÃ­r', english: 'to fry', example: 'FrÃ­e el huevo', exampleEn: 'Fry the egg' },
                    { spanish: 'hornear', english: 'to bake', example: 'Hornea el pastel', exampleEn: 'Bake the cake' },
                    { spanish: 'asar', english: 'to roast/grill', example: 'Asa la carne', exampleEn: 'Roast the meat' },
                    { spanish: 'mezclar', english: 'to mix', example: 'Mezcla los ingredientes', exampleEn: 'Mix the ingredients' },
                    { spanish: 'batir', english: 'to beat/whisk', example: 'Bate los huevos', exampleEn: 'Beat the eggs' },
                    { spanish: 'pelar', english: 'to peel', example: 'Pela las papas', exampleEn: 'Peel the potatoes' },
                    { spanish: 'rallar', english: 'to grate', example: 'Ralla el queso', exampleEn: 'Grate the cheese' },
                    { spanish: 'sazonar', english: 'to season', example: 'Sazona con sal', exampleEn: 'Season with salt' }
                ]
            },
            sleeping: {
                name: 'Sleep & Rest',
                emoji: 'ðŸ˜´',
                iconSearch: 'sleep bed',
                color: '#818CF8',
                verbs: [
                    { spanish: 'dormir', english: 'to sleep', example: 'Duermo ocho horas', exampleEn: 'I sleep eight hours' },
                    { spanish: 'despertar', english: 'to wake up', example: 'Me despertÃ© temprano', exampleEn: 'I woke up early' },
                    { spanish: 'descansar', english: 'to rest', example: 'Necesito descansar', exampleEn: 'I need to rest' },
                    { spanish: 'roncar', english: 'to snore', example: 'Ã‰l ronca mucho', exampleEn: 'He snores a lot' },
                    { spanish: 'bostezar', english: 'to yawn', example: 'No paro de bostezar', exampleEn: "I can't stop yawning" },
                    { spanish: 'acostarse', english: 'to go to bed', example: 'Me acuesto a las diez', exampleEn: 'I go to bed at ten' },
                    { spanish: 'levantarse', english: 'to get up', example: 'Me levanto a las seis', exampleEn: 'I get up at six' },
                    { spanish: 'dormitar', english: 'to doze', example: 'Dormitaba en el sofÃ¡', exampleEn: 'He was dozing on the sofa' }
                ]
            },
            water: {
                name: 'Water Actions',
                emoji: 'ðŸ’§',
                iconSearch: 'swimming water',
                color: '#0EA5E9',
                verbs: [
                    { spanish: 'nadar', english: 'to swim', example: 'Nado todos los dÃ­as', exampleEn: 'I swim every day' },
                    { spanish: 'flotar', english: 'to float', example: 'El barco flota', exampleEn: 'The boat floats' },
                    { spanish: 'hundir', english: 'to sink', example: 'El barco se hundiÃ³', exampleEn: 'The ship sank' },
                    { spanish: 'bucear', english: 'to dive/scuba', example: 'Buceamos en el mar', exampleEn: 'We dove in the sea' },
                    { spanish: 'salpicar', english: 'to splash', example: 'Me salpicÃ³ agua', exampleEn: 'He splashed water on me' },
                    { spanish: 'mojar', english: 'to wet', example: 'Moja la esponja', exampleEn: 'Wet the sponge' },
                    { spanish: 'regar', english: 'to water', example: 'Riega las plantas', exampleEn: 'Water the plants' },
                    { spanish: 'derramar', english: 'to spill', example: 'DerramÃ© el cafÃ©', exampleEn: 'I spilled the coffee' },
                    { spanish: 'gotear', english: 'to drip', example: 'El grifo gotea', exampleEn: 'The faucet drips' }
                ]
            },
            money: {
                name: 'Money',
                emoji: 'ðŸ’°',
                iconSearch: 'money dollar',
                color: '#84CC16',
                verbs: [
                    { spanish: 'pagar', english: 'to pay', example: 'Yo pago la cuenta', exampleEn: "I'll pay the bill" },
                    { spanish: 'cobrar', english: 'to charge/collect', example: 'Me cobrÃ³ demasiado', exampleEn: 'He charged me too much' },
                    { spanish: 'ahorrar', english: 'to save', example: 'Ahorro para un carro', exampleEn: "I'm saving for a car" },
                    { spanish: 'gastar', english: 'to spend', example: 'GastÃ© todo mi dinero', exampleEn: 'I spent all my money' },
                    { spanish: 'deber', english: 'to owe', example: 'Te debo veinte dÃ³lares', exampleEn: 'I owe you twenty dollars' },
                    { spanish: 'prestar', english: 'to lend', example: 'Me prestÃ³ dinero', exampleEn: 'He lent me money' },
                    { spanish: 'invertir', english: 'to invest', example: 'InvirtiÃ³ en acciones', exampleEn: 'He invested in stocks' },
                    { spanish: 'comprar', english: 'to buy', example: 'ComprÃ© un regalo', exampleEn: 'I bought a gift' },
                    { spanish: 'vender', english: 'to sell', example: 'VendiÃ³ su casa', exampleEn: 'She sold her house' }
                ]
            },
            fighting: {
                name: 'Fighting',
                emoji: 'ðŸ‘Š',
                iconSearch: 'fist punch',
                color: '#EF4444',
                verbs: [
                    { spanish: 'pelear', english: 'to fight', example: 'No quiero pelear', exampleEn: "I don't want to fight" },
                    { spanish: 'golpear', english: 'to hit/punch', example: 'Lo golpeÃ³ en la cara', exampleEn: 'He punched him in the face' },
                    { spanish: 'patear', english: 'to kick', example: 'PateÃ³ la pelota', exampleEn: 'He kicked the ball' },
                    { spanish: 'luchar', english: 'to struggle/wrestle', example: 'Luchan por sus derechos', exampleEn: 'They fight for their rights' },
                    { spanish: 'atacar', english: 'to attack', example: 'El perro atacÃ³', exampleEn: 'The dog attacked' },
                    { spanish: 'defender', english: 'to defend', example: 'DefendiÃ³ a su amigo', exampleEn: 'He defended his friend' },
                    { spanish: 'empuÃ±ar', english: 'to grip/clench', example: 'EmpuÃ±Ã³ la espada', exampleEn: 'He gripped the sword' },
                    { spanish: 'derrotar', english: 'to defeat', example: 'Derrotaron al enemigo', exampleEn: 'They defeated the enemy' },
                    { spanish: 'vencer', english: 'to overcome/beat', example: 'VenciÃ³ sus miedos', exampleEn: 'She overcame her fears' }
                ]
            },
            sounds: {
                name: 'Sounds',
                emoji: 'ðŸ”Š',
                iconSearch: 'speaker sound',
                color: '#A855F7',
                verbs: [
                    { spanish: 'oÃ­r', english: 'to hear', example: 'Â¿Oyes eso?', exampleEn: 'Do you hear that?' },
                    { spanish: 'escuchar', english: 'to listen', example: 'Escucha la mÃºsica', exampleEn: 'Listen to the music' },
                    { spanish: 'sonar', english: 'to sound/ring', example: 'Suena el telÃ©fono', exampleEn: 'The phone is ringing' },
                    { spanish: 'cantar', english: 'to sing', example: 'Canta muy bien', exampleEn: 'She sings very well' },
                    { spanish: 'gritar', english: 'to shout', example: 'Â¡No me grites!', exampleEn: "Don't shout at me!" },
                    { spanish: 'llorar', english: 'to cry', example: 'El bebÃ© llora', exampleEn: 'The baby is crying' },
                    { spanish: 'reÃ­r', english: 'to laugh', example: 'Nos reÃ­mos mucho', exampleEn: 'We laughed a lot' },
                    { spanish: 'aplaudir', english: 'to clap', example: 'El pÃºblico aplaudiÃ³', exampleEn: 'The audience clapped' },
                    { spanish: 'zumbar', english: 'to buzz', example: 'Las abejas zumban', exampleEn: 'The bees buzz' },
                    { spanish: 'crujir', english: 'to creak/crunch', example: 'La puerta cruje', exampleEn: 'The door creaks' }
                ]
            },
            wearing: {
                name: 'Wearing & Clothes',
                emoji: 'ðŸ‘•',
                iconSearch: 'shirt clothes',
                color: '#F472B6',
                verbs: [
                    { spanish: 'vestir', english: 'to dress', example: 'Viste a los niÃ±os', exampleEn: 'Dress the children' },
                    { spanish: 'llevar', english: 'to wear', example: 'Lleva un vestido rojo', exampleEn: "She's wearing a red dress" },
                    { spanish: 'ponerse', english: 'to put on', example: 'Ponte la chaqueta', exampleEn: 'Put on your jacket' },
                    { spanish: 'quitarse', english: 'to take off', example: 'QuÃ­tate los zapatos', exampleEn: 'Take off your shoes' },
                    { spanish: 'abotonar', english: 'to button', example: 'Abotona tu camisa', exampleEn: 'Button your shirt' },
                    { spanish: 'desabotonar', english: 'to unbutton', example: 'DesabotonÃ³ su abrigo', exampleEn: 'She unbuttoned her coat' },
                    { spanish: 'atar', english: 'to tie', example: 'Ata tus zapatos', exampleEn: 'Tie your shoes' },
                    { spanish: 'desatar', english: 'to untie', example: 'Desata el nudo', exampleEn: 'Untie the knot' },
                    { spanish: 'probarse', english: 'to try on', example: 'Me probÃ© el vestido', exampleEn: 'I tried on the dress' }
                ]
            },
            creating: {
                name: 'Creating',
                emoji: 'ðŸŽ¨',
                iconSearch: 'paint art palette',
                color: '#EC4899',
                verbs: [
                    { spanish: 'crear', english: 'to create', example: 'CreÃ³ una obra de arte', exampleEn: 'He created a work of art' },
                    { spanish: 'dibujar', english: 'to draw', example: 'Dibuja un Ã¡rbol', exampleEn: 'Draw a tree' },
                    { spanish: 'pintar', english: 'to paint', example: 'Pinta la pared', exampleEn: 'Paint the wall' },
                    { spanish: 'escribir', english: 'to write', example: 'Escribe una carta', exampleEn: 'Write a letter' },
                    { spanish: 'diseÃ±ar', english: 'to design', example: 'DiseÃ±Ã³ el logo', exampleEn: 'She designed the logo' },
                    { spanish: 'construir', english: 'to build', example: 'Construyeron una casa', exampleEn: 'They built a house' },
                    { spanish: 'inventar', english: 'to invent', example: 'InventÃ³ una mÃ¡quina', exampleEn: 'He invented a machine' },
                    { spanish: 'componer', english: 'to compose', example: 'Compuso una canciÃ³n', exampleEn: 'She composed a song' },
                    { spanish: 'esculpir', english: 'to sculpt', example: 'EsculpiÃ³ una estatua', exampleEn: 'He sculpted a statue' },
                    { spanish: 'tejer', english: 'to knit/weave', example: 'Teje un suÃ©ter', exampleEn: 'She knits a sweater' }
                ]
            },
            health: {
                name: 'Health & Body',
                emoji: 'ðŸ¥',
                iconSearch: 'medical health',
                color: '#10B981',
                verbs: [
                    { spanish: 'respirar', english: 'to breathe', example: 'Respira profundo', exampleEn: 'Breathe deeply' },
                    { spanish: 'toser', english: 'to cough', example: 'No para de toser', exampleEn: "He can't stop coughing" },
                    { spanish: 'estornudar', english: 'to sneeze', example: 'EstornudÃ© tres veces', exampleEn: 'I sneezed three times' },
                    { spanish: 'sudar', english: 'to sweat', example: 'Sudo mucho en verano', exampleEn: 'I sweat a lot in summer' },
                    { spanish: 'sangrar', english: 'to bleed', example: 'Me sangra la nariz', exampleEn: 'My nose is bleeding' },
                    { spanish: 'curar', english: 'to heal/cure', example: 'El doctor lo curÃ³', exampleEn: 'The doctor cured him' },
                    { spanish: 'doler', english: 'to hurt', example: 'Me duele la cabeza', exampleEn: 'My head hurts' },
                    { spanish: 'vomitar', english: 'to vomit', example: 'El niÃ±o vomitÃ³', exampleEn: 'The child vomited' },
                    { spanish: 'desmayarse', english: 'to faint', example: 'Se desmayÃ³ del calor', exampleEn: 'She fainted from the heat' },
                    { spanish: 'temblar', english: 'to tremble', example: 'Temblaba de frÃ­o', exampleEn: 'He was trembling from cold' }
                ]
            }
        };

        // Store loaded icon URLs
        const categoryIcons = new Map();

        const svg = d3.select('#canvas');
        const tooltip = d3.select('.tooltip');
        const loadingStatus = document.getElementById('loadingStatus');

        // Create category list (with placeholders)
        const categoryContainer = document.getElementById('categories');
        Object.entries(categories).forEach(([key, cat]) => {
            const item = document.createElement('div');
            item.className = 'category-item';
            item.id = `cat-${key}`;
            item.style.setProperty('--cat-color', cat.color);
            item.innerHTML = `
                <div class="icon-container loading" id="cat-icon-${key}">
                    <span class="emoji">${cat.emoji}</span>
                </div>
                <span class="name">${cat.name}</span>
                <span class="count">${cat.verbs.length}</span>
            `;
            item.addEventListener('click', () => selectCategory(key));
            categoryContainer.appendChild(item);
        });

        let simulation = null;

        // Load all category icons
        async function loadCategoryIcons() {
            const freepik = new FreepikAPI();
            const keys = Object.keys(categories);
            let loaded = 0;

            for (const key of keys) {
                const cat = categories[key];
                try {
                    const result = await freepik.searchAndGetIcon(cat.iconSearch, 128);
                    const iconContainer = document.getElementById(`cat-icon-${key}`);

                    if (result && result.pngUrl) {
                        iconContainer.innerHTML = `<img src="${result.pngUrl}" alt="${cat.name}" />`;
                        iconContainer.classList.remove('loading');
                        categoryIcons.set(key, result.pngUrl);
                    } else {
                        // Keep emoji as fallback
                        iconContainer.classList.remove('loading');
                    }

                    loaded++;
                    loadingStatus.textContent = `Loading icons... ${loaded}/${keys.length}`;
                } catch (e) {
                    console.error(`Failed to load icon for ${cat.name}:`, e);
                    document.getElementById(`cat-icon-${key}`).classList.remove('loading');
                }
            }

            loadingStatus.style.opacity = '0';
            setTimeout(() => loadingStatus.style.display = 'none', 300);
        }

        function selectCategory(key) {
            // Update selection UI
            document.querySelectorAll('.category-item').forEach((el, i) => {
                const catKey = Object.keys(categories)[i];
                el.classList.toggle('selected', catKey === key);
            });

            const category = categories[key];
            const iconUrl = categoryIcons.get(key);
            renderVerbs(category, iconUrl);
        }

        function renderVerbs(category, iconUrl) {
            svg.selectAll('*').remove();

            // Center node with icon or emoji
            const centerNode = {
                id: 'center',
                isCenter: true,
                emoji: category.emoji,
                iconUrl: iconUrl,
                radius: 55,
                fx: width / 2,
                fy: height / 2
            };

            const verbNodes = category.verbs.map((verb, i) => ({
                ...verb,
                id: verb.spanish,
                isCenter: false,
                radius: 45 + Math.random() * 10,
                x: width / 2 + (Math.random() - 0.5) * 200,
                y: height / 2 + (Math.random() - 0.5) * 200
            }));

            const nodes = [centerNode, ...verbNodes];

            const links = verbNodes.map(v => ({
                source: 'center',
                target: v.id
            }));

            if (simulation) simulation.stop();

            simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(140).strength(0.3))
                .force('charge', d3.forceManyBody().strength(d => d.isCenter ? 0 : -400))
                .force('collision', d3.forceCollide().radius(d => d.radius + 8));

            const linkElements = svg.append('g')
                .selectAll('line')
                .data(links)
                .enter()
                .append('line')
                .attr('stroke', category.color)
                .attr('stroke-opacity', 0.2)
                .attr('stroke-width', 1.5);

            const groups = svg.selectAll('g.node')
                .data(nodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .style('cursor', d => d.isCenter ? 'default' : 'pointer');

            groups.append('circle')
                .attr('r', d => d.radius)
                .attr('fill', d => d.isCenter ? category.color : category.color)
                .attr('fill-opacity', d => d.isCenter ? 0.9 : 0.2)
                .attr('stroke', category.color)
                .attr('stroke-width', d => d.isCenter ? 3 : 2);

            // Add icon image or emoji to center node
            const centerGroup = groups.filter(d => d.isCenter);

            // Add a clip path for circular image
            svg.append('defs')
                .append('clipPath')
                .attr('id', 'center-clip')
                .append('circle')
                .attr('r', 40);

            if (iconUrl) {
                centerGroup.append('image')
                    .attr('href', iconUrl)
                    .attr('width', 70)
                    .attr('height', 70)
                    .attr('x', -35)
                    .attr('y', -35)
                    .style('filter', 'brightness(1.2)');
            } else {
                centerGroup.append('text')
                    .attr('text-anchor', 'middle')
                    .attr('dy', 12)
                    .attr('font-size', '36px')
                    .text(d => d.emoji);
            }

            groups.filter(d => !d.isCenter)
                .append('text')
                .attr('class', 'verb-label')
                .attr('dy', -4)
                .text(d => d.spanish);

            groups.filter(d => !d.isCenter)
                .append('text')
                .attr('class', 'verb-english')
                .attr('dy', 14)
                .text(d => d.english);

            groups.filter(d => !d.isCenter)
                .on('mouseover', function(event, d) {
                    d3.select(this).select('circle')
                        .attr('fill-opacity', 0.4)
                        .attr('stroke-width', 3);

                    linkElements.attr('stroke-opacity', l => l.target.id === d.id ? 0.6 : 0.2)
                        .attr('stroke-width', l => l.target.id === d.id ? 2.5 : 1.5);

                    tooltip
                        .style('opacity', 1)
                        .style('left', (event.pageX + 15) + 'px')
                        .style('top', (event.pageY - 10) + 'px')
                        .html(`
                            <div class="spanish">${d.spanish}</div>
                            <div class="english">${d.english}</div>
                            <div class="example">"${d.example}"</div>
                            <div class="example-trans">${d.exampleEn}</div>
                        `);
                })
                .on('mouseout', function(d) {
                    d3.select(this).select('circle')
                        .attr('fill-opacity', 0.2)
                        .attr('stroke-width', 2);
                    linkElements.attr('stroke-opacity', 0.2).attr('stroke-width', 1.5);
                    tooltip.style('opacity', 0);
                })
                .on('click', function(event, d) {
                    const utterance = new SpeechSynthesisUtterance(d.spanish);
                    utterance.lang = 'es-ES';
                    utterance.rate = 0.8;
                    speechSynthesis.speak(utterance);
                });

            simulation.on('tick', () => {
                linkElements
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                groups.attr('transform', d => {
                    if (!d.isCenter) {
                        d.x = Math.max(d.radius, Math.min(width - d.radius, d.x));
                        d.y = Math.max(d.radius, Math.min(height - d.radius, d.y));
                    }
                    return `translate(${d.x}, ${d.y})`;
                });
            });
        }

        // Initialize
        selectCategory('mouth');
        loadCategoryIcons();
    </script>
</body>
</html>
