<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Draft History - 1980-2024</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #0a0a0a;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        h1 {
            font-size: 28px;
            text-align: center;
            margin-bottom: 5px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .control-group label {
            font-size: 12px;
            color: #888;
        }
        select {
            background: #222;
            color: #fff;
            border: 1px solid #444;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        select:hover {
            border-color: #666;
        }
        .draft-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .tooltip {
            position: fixed;
            background: rgba(0,0,0,0.95);
            border: 1px solid #444;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
            z-index: 1000;
            max-width: 300px;
        }
        .tooltip .name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 4px;
        }
        .tooltip .details {
            color: #aaa;
            line-height: 1.5;
        }
        .tooltip .highlight {
            color: #4ade80;
            font-weight: bold;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            font-size: 11px;
            color: #888;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .hof-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            font-size: 8px;
            font-weight: bold;
            padding: 1px 4px;
            border-radius: 2px;
        }
        .stats-summary {
            text-align: center;
            margin: 10px 0;
            font-size: 13px;
            color: #888;
        }
        .stats-summary span {
            color: #4ade80;
            font-weight: bold;
        }
        .round-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .round-label {
            width: 80px;
            font-size: 12px;
            font-weight: bold;
            color: #666;
            text-align: right;
            padding-right: 15px;
        }
        .round-picks {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            flex: 1;
        }
    </style>
</head>
<body>
    <h1>NFL Draft History</h1>
    <div class="controls">
        <div class="control-group">
            <label>Draft Year</label>
            <select id="year-select"></select>
        </div>
        <div class="control-group">
            <label>Show Stat</label>
            <select id="stat-select">
                <option value="games">Games Played</option>
                <option value="seasons_started">Seasons Started</option>
                <option value="probowls">Pro Bowls</option>
                <option value="allpro">All-Pro Selections</option>
                <option value="w_av">Career Value (AV)</option>
                <option value="pass_tds">Passing TDs</option>
                <option value="rush_yards">Rush Yards (100s)</option>
                <option value="rec_yards">Rec Yards (100s)</option>
                <option value="rush_tds">Rush TDs</option>
                <option value="rec_tds">Rec TDs</option>
                <option value="def_sacks">Sacks</option>
                <option value="def_ints">Interceptions</option>
            </select>
        </div>
    </div>
    <div class="stats-summary" id="summary"></div>
    <div class="legend">
        <div class="legend-item">
            <svg width="16" height="16"><circle cx="8" cy="8" r="6" fill="#1e40af"/></svg>
            <span>Offense</span>
        </div>
        <div class="legend-item">
            <svg width="16" height="16"><circle cx="8" cy="8" r="6" fill="#991b1b"/></svg>
            <span>Defense</span>
        </div>
        <div class="legend-item">
            <svg width="16" height="16"><circle cx="8" cy="8" r="6" fill="#065f46"/></svg>
            <span>Special Teams</span>
        </div>
        <div class="legend-item">
            <span class="hof-badge">HOF</span>
            <span>Hall of Fame</span>
        </div>
    </div>
    <div class="draft-container" id="draft-container"></div>
    <div class="tooltip" id="tooltip"></div>

    <script>
        let allData = [];
        const tooltip = document.getElementById('tooltip');

        // Load data
        d3.csv('draft_picks.csv').then(data => {
            allData = data.map(d => ({
                ...d,
                season: +d.season,
                round: +d.round,
                pick: +d.pick,
                games: +d.games || 0,
                seasons_started: +d.seasons_started || 0,
                probowls: +d.probowls || 0,
                allpro: +d.allpro || 0,
                w_av: +d.w_av || 0,
                pass_tds: +d.pass_tds || 0,
                rush_yards: Math.round((+d.rush_yards || 0) / 100),
                rec_yards: Math.round((+d.rec_yards || 0) / 100),
                rush_tds: +d.rush_tds || 0,
                rec_tds: +d.rec_tds || 0,
                def_sacks: Math.round(+d.def_sacks || 0),
                def_ints: +d.def_ints || 0,
                hof: d.hof === 'TRUE'
            }));

            // Populate year dropdown
            const years = [...new Set(allData.map(d => d.season))].sort((a, b) => b - a);
            const yearSelect = document.getElementById('year-select');
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === 2000) option.selected = true;
                yearSelect.appendChild(option);
            });

            // Initial render
            renderDraft(2000, 'games');

            // Event listeners
            yearSelect.addEventListener('change', () => {
                renderDraft(+yearSelect.value, document.getElementById('stat-select').value);
            });
            document.getElementById('stat-select').addEventListener('change', (e) => {
                renderDraft(+yearSelect.value, e.target.value);
            });
        });

        function renderDraft(year, stat) {
            const yearData = allData.filter(d => d.season === year);
            const rounds = [...new Set(yearData.map(d => d.round))].sort((a, b) => a - b);

            // Get max stat value for scaling
            const statMaxes = {
                games: 300,
                seasons_started: 15,
                probowls: 12,
                allpro: 8,
                w_av: 150,
                pass_tds: 300,
                rush_yards: 120,  // in 100s, so 12,000 yards
                rec_yards: 150,   // in 100s, so 15,000 yards
                rush_tds: 100,
                rec_tds: 100,
                def_sacks: 120,
                def_ints: 60
            };
            const maxStat = statMaxes[stat];

            // Calculate summary stats
            const hofCount = yearData.filter(d => d.hof).length;
            const avgGames = Math.round(yearData.reduce((sum, d) => sum + d.games, 0) / yearData.length);
            const totalProBowls = yearData.reduce((sum, d) => sum + d.probowls, 0);

            document.getElementById('summary').innerHTML =
                `${yearData.length} picks &nbsp;|&nbsp; ` +
                `<span>${hofCount}</span> Hall of Famers &nbsp;|&nbsp; ` +
                `<span>${avgGames}</span> avg games &nbsp;|&nbsp; ` +
                `<span>${totalProBowls}</span> total Pro Bowls`;

            // Group by round
            const byRound = {};
            rounds.forEach(r => byRound[r] = []);
            yearData.forEach(d => {
                if (byRound[d.round]) byRound[d.round].push(d);
            });

            // Sort each round by pick number
            Object.values(byRound).forEach(arr => arr.sort((a, b) => a.pick - b.pick));

            const container = document.getElementById('draft-container');
            container.innerHTML = '';

            // Create rows for each round
            rounds.forEach(round => {
                const picks = byRound[round];

                const rowDiv = document.createElement('div');
                rowDiv.className = 'round-row';

                const labelDiv = document.createElement('div');
                labelDiv.className = 'round-label';
                labelDiv.textContent = `Round ${round}`;
                rowDiv.appendChild(labelDiv);

                const picksDiv = document.createElement('div');
                picksDiv.className = 'round-picks';

                const svg = d3.select(picksDiv)
                    .append('svg')
                    .attr('width', picks.length * 38 + 10)
                    .attr('height', 50);

                picks.forEach((d, i) => {
                    const x = i * 38 + 20;
                    const y = 25;

                    const statValue = d[stat];
                    const radius = 6 + (statValue / maxStat) * 12;

                    // Color by side
                    let color = '#444';
                    if (d.side === 'O') color = '#1e40af';
                    else if (d.side === 'D') color = '#991b1b';
                    else if (d.category === 'K' || d.category === 'P') color = '#065f46';

                    const g = svg.append('g')
                        .style('cursor', 'pointer')
                        .on('mouseover', function(event) {
                            const statLabel = {
                                games: 'Games',
                                seasons_started: 'Seasons Started',
                                probowls: 'Pro Bowls',
                                allpro: 'All-Pro',
                                w_av: 'Career AV',
                                pass_tds: 'Pass TDs',
                                rush_yards: 'Rush Yards (100s)',
                                rec_yards: 'Rec Yards (100s)',
                                rush_tds: 'Rush TDs',
                                rec_tds: 'Rec TDs',
                                def_sacks: 'Sacks',
                                def_ints: 'INTs'
                            }[stat];

                            let html = `<div class="name">${d.pfr_player_name || 'Unknown'}${d.hof ? ' <span class="hof-badge">HOF</span>' : ''}</div>`;
                            html += `<div class="details">`;
                            html += `Pick ${d.pick} (Round ${d.round})<br>`;
                            html += `${d.position} - ${d.team}<br>`;
                            html += `${d.college || 'Unknown college'}<br><br>`;
                            html += `<span class="highlight">${statLabel}: ${statValue}</span><br>`;
                            html += `Games: ${d.games} | Pro Bowls: ${d.probowls}<br>`;
                            html += `All-Pro: ${d.allpro} | Career AV: ${d.car_av}`;
                            html += `</div>`;

                            tooltip.innerHTML = html;
                            tooltip.style.opacity = 1;
                            tooltip.style.left = (event.clientX + 15) + 'px';
                            tooltip.style.top = (event.clientY - 10) + 'px';
                        })
                        .on('mouseout', function() {
                            tooltip.style.opacity = 0;
                        });

                    // Circle
                    g.append('circle')
                        .attr('cx', x)
                        .attr('cy', y)
                        .attr('r', Math.max(radius, 6))
                        .attr('fill', color)
                        .attr('stroke', d.hof ? '#FFD700' : '#333')
                        .attr('stroke-width', d.hof ? 2.5 : 1);

                    // Number inside
                    if (statValue > 0) {
                        g.append('text')
                            .attr('x', x)
                            .attr('y', y)
                            .attr('text-anchor', 'middle')
                            .attr('dy', '0.35em')
                            .attr('font-size', radius > 10 ? '9px' : '7px')
                            .attr('fill', '#fff')
                            .attr('pointer-events', 'none')
                            .text(statValue);
                    }
                });

                rowDiv.appendChild(picksDiv);
                container.appendChild(rowDiv);
            });
        }
    </script>
</body>
</html>
