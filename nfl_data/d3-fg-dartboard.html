<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Field Goal Dartboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #0a0a0a;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            font-size: 28px;
            text-align: center;
            margin-bottom: 5px;
        }
        .subtitle {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .control-group label {
            font-size: 12px;
            color: #888;
        }
        select {
            background: #222;
            color: #fff;
            border: 1px solid #444;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        .dartboard-container {
            position: relative;
        }
        .stats {
            text-align: center;
            margin: 20px 0;
            font-size: 14px;
            color: #888;
        }
        .stats span {
            color: #4ade80;
            font-weight: bold;
        }
        .stats .miss {
            color: #ef4444;
        }
        .tooltip {
            position: fixed;
            background: rgba(0,0,0,0.95);
            border: 1px solid #444;
            padding: 10px 14px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
            z-index: 1000;
        }
        .tooltip .distance {
            font-weight: bold;
            font-size: 16px;
        }
        .tooltip .made {
            color: #4ade80;
        }
        .tooltip .missed {
            color: #ef4444;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 15px 0;
            font-size: 12px;
            color: #888;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <h1>NFL Field Goal Dartboard</h1>
    <p class="subtitle">Each dot = one field goal attempt</p>
    <div class="controls">
        <div class="control-group">
            <label>Season</label>
            <select id="year-select"></select>
        </div>
    </div>
    <div class="stats" id="stats"></div>
    <div class="legend">
        <div class="legend-item">
            <svg width="14" height="14"><circle cx="7" cy="7" r="5" fill="#4ade80"/></svg>
            <span>Made</span>
        </div>
        <div class="legend-item">
            <svg width="14" height="14"><circle cx="7" cy="7" r="5" fill="#ef4444"/></svg>
            <span>Missed</span>
        </div>
    </div>
    <div class="dartboard-container" id="dartboard"></div>
    <div class="tooltip" id="tooltip"></div>

    <script>
        let data = null;
        const tooltip = document.getElementById('tooltip');

        // Load data
        fetch('fg_kicks_by_year.json')
            .then(res => res.json())
            .then(json => {
                data = json;

                // Populate year dropdown
                const years = Object.keys(data.seasons).map(Number).sort((a, b) => b - a);
                const yearSelect = document.getElementById('year-select');
                years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    if (year === 2024) option.selected = true;
                    yearSelect.appendChild(option);
                });

                renderDartboard(2024);

                yearSelect.addEventListener('change', (e) => {
                    renderDartboard(+e.target.value);
                });
            });

        function renderDartboard(year) {
            const seasonData = data.seasons[year];
            if (!seasonData) return;

            const container = document.getElementById('dartboard');
            container.innerHTML = '';

            const width = 700;
            const height = 700;
            const centerX = width / 2;
            const centerY = height / 2;
            const maxRadius = 320;

            // Distance range (typically 18-65 yards)
            const minDist = 18;
            const maxDist = 66;

            // Scale: closer kicks = inner rings, longer = outer
            const radiusScale = d3.scaleLinear()
                .domain([minDist, maxDist])
                .range([30, maxRadius]);

            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // Draw distance rings
            const ringDistances = [20, 30, 40, 50, 60];
            ringDistances.forEach(dist => {
                const r = radiusScale(dist);
                svg.append('circle')
                    .attr('cx', centerX)
                    .attr('cy', centerY)
                    .attr('r', r)
                    .attr('fill', 'none')
                    .attr('stroke', '#333')
                    .attr('stroke-width', 1);

                svg.append('text')
                    .attr('x', centerX + r + 5)
                    .attr('y', centerY)
                    .attr('fill', '#555')
                    .attr('font-size', '11px')
                    .attr('dy', '0.35em')
                    .text(`${dist} yds`);
            });

            // Goal post at center
            svg.append('circle')
                .attr('cx', centerX)
                .attr('cy', centerY)
                .attr('r', 15)
                .attr('fill', '#FFD700')
                .attr('opacity', 0.8);

            svg.append('text')
                .attr('x', centerX)
                .attr('y', centerY)
                .attr('text-anchor', 'middle')
                .attr('dy', '0.35em')
                .attr('fill', '#000')
                .attr('font-size', '10px')
                .attr('font-weight', 'bold')
                .text('FG');

            // Calculate totals for stats
            let totalMade = 0, totalMissed = 0;
            let made50plus = 0, att50plus = 0;

            // Plot each kick
            seasonData.forEach(d => {
                const distance = d.distance;
                const baseRadius = radiusScale(distance);

                totalMade += d.made;
                totalMissed += d.missed;

                if (distance >= 50) {
                    made50plus += d.made;
                    att50plus += d.made + d.missed;
                }

                // Create dots for each attempt
                const totalAttempts = d.made + d.missed;

                // Spread dots around the ring for this distance
                for (let i = 0; i < d.made; i++) {
                    const angle = (Math.random() * Math.PI * 2);
                    const radiusJitter = baseRadius + (Math.random() - 0.5) * 15;
                    const x = centerX + Math.cos(angle) * radiusJitter;
                    const y = centerY + Math.sin(angle) * radiusJitter;

                    svg.append('circle')
                        .attr('cx', x)
                        .attr('cy', y)
                        .attr('r', 4)
                        .attr('fill', '#4ade80')
                        .attr('opacity', 0.8)
                        .style('cursor', 'pointer')
                        .on('mouseover', function(event) {
                            showTooltip(event, distance, d.made, d.missed);
                        })
                        .on('mouseout', hideTooltip);
                }

                for (let i = 0; i < d.missed; i++) {
                    const angle = (Math.random() * Math.PI * 2);
                    const radiusJitter = baseRadius + (Math.random() - 0.5) * 15;
                    const x = centerX + Math.cos(angle) * radiusJitter;
                    const y = centerY + Math.sin(angle) * radiusJitter;

                    svg.append('circle')
                        .attr('cx', x)
                        .attr('cy', y)
                        .attr('r', 4)
                        .attr('fill', '#ef4444')
                        .attr('opacity', 0.8)
                        .style('cursor', 'pointer')
                        .on('mouseover', function(event) {
                            showTooltip(event, distance, d.made, d.missed);
                        })
                        .on('mouseout', hideTooltip);
                }
            });

            // Update stats
            const totalAtt = totalMade + totalMissed;
            const pct = totalAtt > 0 ? (totalMade / totalAtt * 100).toFixed(1) : 0;
            const pct50 = att50plus > 0 ? (made50plus / att50plus * 100).toFixed(1) : 0;

            document.getElementById('stats').innerHTML = `
                <span>${totalMade}</span> made / <span class="miss">${totalMissed}</span> missed
                (<span>${pct}%</span>) &nbsp;|&nbsp;
                50+ yards: <span>${made50plus}</span>/<span>${att50plus}</span> (<span>${pct50}%</span>)
            `;
        }

        function showTooltip(event, distance, made, missed) {
            const total = made + missed;
            const pct = total > 0 ? (made / total * 100).toFixed(0) : 0;
            tooltip.innerHTML = `
                <div class="distance">${distance} yards</div>
                <div><span class="made">${made} made</span> / <span class="missed">${missed} missed</span></div>
                <div>${pct}% success</div>
            `;
            tooltip.style.opacity = 1;
            tooltip.style.left = (event.clientX + 15) + 'px';
            tooltip.style.top = (event.clientY - 10) + 'px';
        }

        function hideTooltip() {
            tooltip.style.opacity = 0;
        }
    </script>
</body>
</html>
