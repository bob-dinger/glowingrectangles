<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Tax Brackets 2025</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #fff;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #999;
            text-decoration: none;
            font-size: 13px;
            z-index: 100;
        }
        .back-link:hover { color: #333; }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 60px 40px 30px;
            overflow: hidden;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #059669, #3B82F6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #888;
            font-size: 13px;
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group label {
            font-size: 13px;
            color: #666;
        }

        .input-group input {
            padding: 8px 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 140px;
            text-align: right;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3B82F6;
        }

        .toggle-group {
            display: flex;
            background: #f0f0f0;
            border-radius: 6px;
            padding: 3px;
        }

        .toggle-btn {
            padding: 6px 14px;
            font-size: 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 4px;
            color: #666;
            transition: all 0.2s;
        }

        .toggle-btn.active {
            background: #fff;
            color: #333;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .results {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .result-card {
            text-align: center;
            padding: 15px 25px;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .result-card .label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .result-card .value {
            font-size: 28px;
            font-weight: 700;
        }

        .result-card .sub {
            font-size: 12px;
            color: #888;
            margin-top: 3px;
        }

        .result-card.marginal .value { color: #EF4444; }
        .result-card.effective .value { color: #059669; }
        .result-card.total .value { color: #3B82F6; }

        #chart {
            flex: 1;
            min-height: 0;
        }

        .bracket-bar {
            transition: opacity 0.2s;
        }

        .bracket-bar:hover {
            opacity: 0.85;
        }

        .income-line {
            stroke: #333;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        .axis text {
            font-size: 11px;
            fill: #666;
        }

        .axis line, .axis path {
            stroke: #ddd;
        }

        .bracket-label {
            font-size: 11px;
            fill: #fff;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: #fafafa;
            border-left: 1px solid #e0e0e0;
            padding: 25px;
            overflow-y: auto;
            display: none;
        }

        @media (min-width: 1100px) {
            .sidebar { display: block; }
        }

        .sidebar h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #059669;
        }

        .sidebar p {
            color: #666;
            font-size: 13px;
            line-height: 1.7;
            margin-bottom: 15px;
        }

        .sidebar strong {
            color: #333;
        }

        .sidebar em {
            color: #059669;
            font-style: normal;
        }

        .sidebar .example {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-size: 12px;
        }

        .sidebar .example .row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .sidebar .example .row:last-child {
            border-bottom: none;
            font-weight: 600;
            padding-top: 8px;
            margin-top: 4px;
            border-top: 1px solid #e0e0e0;
        }

        .sidebar .example .bracket {
            color: #888;
        }

        .sidebar .source {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #888;
        }

        .sidebar .source a {
            color: #3B82F6;
            text-decoration: none;
        }

        .breakdown {
            margin-top: 15px;
        }

        .breakdown h3 {
            font-size: 13px;
            color: #333;
            margin-bottom: 10px;
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .breakdown-row .bracket-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 8px;
        }

        .breakdown-row .bracket-info {
            display: flex;
            align-items: center;
            color: #666;
        }

        .breakdown-row .amount {
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>

    <div class="main">
        <header>
            <h1>US Federal Income Tax Brackets</h1>
            <p class="subtitle">2025 Tax Year — See how marginal rates actually work</p>
        </header>

        <div class="controls">
            <div class="input-group">
                <label>Taxable Income:</label>
                <input type="text" id="income" value="85,000" placeholder="Enter income">
            </div>
            <div class="toggle-group">
                <button class="toggle-btn active" data-status="single">Single</button>
                <button class="toggle-btn" data-status="married">Married Filing Jointly</button>
            </div>
        </div>

        <div class="results">
            <div class="result-card marginal">
                <div class="label">Marginal Rate</div>
                <div class="value" id="marginalRate">22%</div>
                <div class="sub">Your tax bracket</div>
            </div>
            <div class="result-card effective">
                <div class="label">Effective Rate</div>
                <div class="value" id="effectiveRate">14.2%</div>
                <div class="sub">What you actually pay</div>
            </div>
            <div class="result-card total">
                <div class="label">Total Tax</div>
                <div class="value" id="totalTax">$12,070</div>
                <div class="sub" id="takeHome">Take home: $72,930</div>
            </div>
        </div>

        <svg id="chart"></svg>
    </div>

    <div class="sidebar">
        <h2>The Misconception</h2>

        <p>Many people think: <em>"If I'm in the 22% bracket, I pay 22% on ALL my income."</em></p>

        <p><strong>This is wrong.</strong> The US uses <em>marginal tax brackets</em> — you only pay each rate on the income <em>within</em> that bracket.</p>

        <h2 style="margin-top: 25px;">How It Works</h2>

        <p>Your income fills up each bracket like water filling containers, from lowest to highest.</p>

        <div class="example" id="exampleBreakdown">
            <!-- Filled by JS -->
        </div>

        <p>Your <strong>marginal rate</strong> is the rate on your <em>last dollar</em>. Your <strong>effective rate</strong> is total tax ÷ total income.</p>

        <h2 style="margin-top: 25px;">Why It Matters</h2>

        <p>A raise that "pushes you into a higher bracket" only taxes the <em>additional</em> income at the higher rate — not your entire salary.</p>

        <p>You'll <strong>never</strong> take home less money by earning more.</p>

        <div class="source">
            2025 Tax Brackets<br>
            <a href="https://www.irs.gov/filing/federal-income-tax-rates-and-brackets" target="_blank">IRS: Tax Rates & Brackets</a>
        </div>
    </div>

    <script>
        // 2025 Tax Brackets
        const brackets = {
            single: [
                { rate: 0.10, min: 0, max: 11925, color: '#22C55E' },
                { rate: 0.12, min: 11925, max: 48475, color: '#84CC16' },
                { rate: 0.22, min: 48475, max: 103350, color: '#EAB308' },
                { rate: 0.24, min: 103350, max: 197300, color: '#F59E0B' },
                { rate: 0.32, min: 197300, max: 250525, color: '#F97316' },
                { rate: 0.35, min: 250525, max: 626350, color: '#EF4444' },
                { rate: 0.37, min: 626350, max: 1000000, color: '#DC2626' }
            ],
            married: [
                { rate: 0.10, min: 0, max: 23850, color: '#22C55E' },
                { rate: 0.12, min: 23850, max: 96950, color: '#84CC16' },
                { rate: 0.22, min: 96950, max: 206700, color: '#EAB308' },
                { rate: 0.24, min: 206700, max: 394600, color: '#F59E0B' },
                { rate: 0.32, min: 394600, max: 501050, color: '#F97316' },
                { rate: 0.35, min: 501050, max: 751600, color: '#EF4444' },
                { rate: 0.37, min: 751600, max: 1500000, color: '#DC2626' }
            ]
        };

        let filingStatus = 'single';
        let income = 85000;

        // Format currency
        const formatCurrency = d => {
            if (d >= 1000000) return '$' + (d / 1000000).toFixed(1) + 'M';
            if (d >= 1000) return '$' + (d / 1000).toFixed(0) + 'K';
            return '$' + d.toFixed(0);
        };

        const formatFullCurrency = d => '$' + d.toLocaleString('en-US', { maximumFractionDigits: 0 });

        // Calculate tax
        function calculateTax(income, status) {
            const bracketData = brackets[status];
            let totalTax = 0;
            let breakdown = [];
            let marginalRate = 0.10;

            for (const bracket of bracketData) {
                if (income > bracket.min) {
                    const taxableInBracket = Math.min(income, bracket.max) - bracket.min;
                    const taxInBracket = taxableInBracket * bracket.rate;
                    totalTax += taxInBracket;
                    marginalRate = bracket.rate;

                    if (taxableInBracket > 0) {
                        breakdown.push({
                            rate: bracket.rate,
                            amount: taxableInBracket,
                            tax: taxInBracket,
                            color: bracket.color
                        });
                    }
                }
            }

            return {
                totalTax,
                effectiveRate: income > 0 ? totalTax / income : 0,
                marginalRate,
                breakdown
            };
        }

        // Update display
        function update() {
            const result = calculateTax(income, filingStatus);

            document.getElementById('marginalRate').textContent = (result.marginalRate * 100).toFixed(0) + '%';
            document.getElementById('effectiveRate').textContent = (result.effectiveRate * 100).toFixed(1) + '%';
            document.getElementById('totalTax').textContent = formatFullCurrency(result.totalTax);
            document.getElementById('takeHome').textContent = 'Take home: ' + formatFullCurrency(income - result.totalTax);

            // Update example breakdown
            let exampleHtml = '';
            result.breakdown.forEach(b => {
                exampleHtml += `
                    <div class="row">
                        <span class="bracket">${(b.rate * 100).toFixed(0)}% on ${formatFullCurrency(b.amount)}</span>
                        <span>${formatFullCurrency(b.tax)}</span>
                    </div>
                `;
            });
            exampleHtml += `
                <div class="row">
                    <span>Total Tax</span>
                    <span>${formatFullCurrency(result.totalTax)}</span>
                </div>
            `;
            document.getElementById('exampleBreakdown').innerHTML = exampleHtml;

            drawChart();
        }

        // Draw chart
        function drawChart() {
            const svg = d3.select('#chart');
            svg.selectAll('*').remove();

            const container = document.getElementById('chart');
            const width = container.clientWidth;
            const height = container.clientHeight;
            const margin = { top: 20, right: 30, bottom: 40, left: 60 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;

            svg.attr('width', width).attr('height', height);

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const bracketData = brackets[filingStatus];
            const maxIncome = Math.max(income * 1.3, bracketData[bracketData.length - 2].max);

            // Scales
            const x = d3.scaleLinear()
                .domain([0, maxIncome])
                .range([0, innerWidth]);

            const y = d3.scaleLinear()
                .domain([0, 0.40])
                .range([innerHeight, 0]);

            // Axes
            g.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x)
                    .ticks(6)
                    .tickFormat(formatCurrency))
                .append('text')
                .attr('x', innerWidth / 2)
                .attr('y', 35)
                .attr('fill', '#666')
                .attr('text-anchor', 'middle')
                .text('Taxable Income');

            g.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y)
                    .ticks(5)
                    .tickFormat(d => (d * 100) + '%'));

            // Draw bracket bars
            bracketData.forEach((bracket, i) => {
                const x1 = x(bracket.min);
                const x2 = x(Math.min(bracket.max, maxIncome));
                const barWidth = x2 - x1;

                if (barWidth > 0) {
                    g.append('rect')
                        .attr('class', 'bracket-bar')
                        .attr('x', x1)
                        .attr('y', y(bracket.rate))
                        .attr('width', barWidth)
                        .attr('height', innerHeight - y(bracket.rate))
                        .attr('fill', bracket.color)
                        .attr('opacity', income > bracket.min ? 0.8 : 0.3);

                    // Label
                    if (barWidth > 40) {
                        g.append('text')
                            .attr('class', 'bracket-label')
                            .attr('x', x1 + barWidth / 2)
                            .attr('y', y(bracket.rate) + 18)
                            .attr('text-anchor', 'middle')
                            .attr('opacity', income > bracket.min ? 1 : 0.5)
                            .text((bracket.rate * 100).toFixed(0) + '%');
                    }
                }
            });

            // Income line
            if (income > 0 && income <= maxIncome) {
                g.append('line')
                    .attr('class', 'income-line')
                    .attr('x1', x(income))
                    .attr('x2', x(income))
                    .attr('y1', 0)
                    .attr('y2', innerHeight);

                g.append('text')
                    .attr('x', x(income))
                    .attr('y', -5)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '12px')
                    .attr('font-weight', '600')
                    .attr('fill', '#333')
                    .text('Your Income: ' + formatFullCurrency(income));
            }

            // Effective rate line
            const result = calculateTax(income, filingStatus);
            if (income > 0) {
                // Draw effective rate curve
                const effectiveLine = d3.line()
                    .x(d => x(d.income))
                    .y(d => y(d.rate))
                    .curve(d3.curveMonotoneX);

                const effectiveData = [];
                for (let i = 0; i <= Math.min(income, maxIncome); i += maxIncome / 100) {
                    const r = calculateTax(i, filingStatus);
                    effectiveData.push({ income: i, rate: r.effectiveRate });
                }
                effectiveData.push({ income: income, rate: result.effectiveRate });

                g.append('path')
                    .datum(effectiveData)
                    .attr('fill', 'none')
                    .attr('stroke', '#059669')
                    .attr('stroke-width', 3)
                    .attr('d', effectiveLine);

                // Effective rate dot
                g.append('circle')
                    .attr('cx', x(income))
                    .attr('cy', y(result.effectiveRate))
                    .attr('r', 6)
                    .attr('fill', '#059669')
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2);

                // Effective rate label
                g.append('text')
                    .attr('x', x(income) + 10)
                    .attr('y', y(result.effectiveRate) + 4)
                    .attr('font-size', '11px')
                    .attr('font-weight', '600')
                    .attr('fill', '#059669')
                    .text('Effective: ' + (result.effectiveRate * 100).toFixed(1) + '%');
            }
        }

        // Event listeners
        document.getElementById('income').addEventListener('input', function(e) {
            const val = e.target.value.replace(/[^0-9]/g, '');
            income = parseInt(val) || 0;
            e.target.value = income.toLocaleString('en-US');
            update();
        });

        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                filingStatus = this.dataset.status;
                update();
            });
        });

        // Initial render
        update();

        // Resize handler
        window.addEventListener('resize', drawChart);
    </script>
</body>
</html>
