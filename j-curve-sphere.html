<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J-Curve Sphere</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a0f;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }
        .back-link {
            position: fixed; top: 20px; left: 20px;
            color: #666; text-decoration: none; font-size: 13px; z-index: 10;
        }
        .back-link:hover { color: #fff; }
        .left {
            width: 40%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 40px; border-right: 1px solid #222;
        }
        .right {
            width: 60%;
            display: flex; justify-content: center; align-items: center;
        }
        .curve-title {
            font-size: 14px; color: #666;
            text-transform: uppercase; letter-spacing: 2px; margin-bottom: 30px;
        }
        .curve-container { position: relative; width: 100%; max-width: 350px; }
        #curveCanvas { width: 100%; border: 1px solid #222; border-radius: 8px; }
        .legend {
            display: flex; flex-direction: column; gap: 12px;
            margin-top: 30px; width: 100%; max-width: 350px;
        }
        .legend-item { display: flex; align-items: center; gap: 12px; font-size: 13px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
        .legend-label { color: #888; }
        .progress-bar {
            width: 100%; max-width: 350px; height: 4px;
            background: #222; border-radius: 2px; margin-top: 30px; overflow: hidden;
        }
        .progress-fill { height: 100%; background: #22C55E; width: 0%; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>
    <div class="left">
        <div class="curve-title">The J-Curve</div>
        <div class="curve-container">
            <canvas id="curveCanvas" width="350" height="250"></canvas>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot" style="background: #3B82F6;"></div>
                <span class="legend-label">Starting Point</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: #EF4444;"></div>
                <span class="legend-label">The Dip — Things Get Worse</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: #EAB308;"></div>
                <span class="legend-label">Valley of Death</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: #22C55E;"></div>
                <span class="legend-label">Recovery & Growth</span>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
    <div class="right">
        <canvas id="sphereCanvas"></canvas>
    </div>

    <script>
        const curveCanvas = document.getElementById('curveCanvas');
        const curveCtx = curveCanvas.getContext('2d');
        const sphereCanvas = document.getElementById('sphereCanvas');
        const sphereCtx = sphereCanvas.getContext('2d');
        const progressFill = document.getElementById('progressFill');

        const segments = [
            { threshold: 0.15, color: '#3B82F6', name: 'Start' },
            { threshold: 0.40, color: '#EF4444', name: 'Dip' },
            { threshold: 0.50, color: '#EAB308', name: 'Valley' },
            { threshold: 1.0, color: '#22C55E', name: 'Growth' }
        ];

        function jCurve(x) {
            if (x < 0.4) {
                return 0.5 - 0.4 * Math.sin(x * Math.PI / 0.4);
            } else {
                return 0.1 + 0.9 * Math.pow((x - 0.4) / 0.6, 1.5);
            }
        }

        function getColor(t) {
            for (let seg of segments) {
                if (t <= seg.threshold) return seg.color;
            }
            return segments[segments.length - 1].color;
        }

        let sphereWidth, sphereHeight, centerX, centerY, radius;

        function resizeSphere() {
            const container = document.querySelector('.right');
            sphereWidth = container.clientWidth;
            sphereHeight = container.clientHeight;
            sphereCanvas.width = sphereWidth;
            sphereCanvas.height = sphereHeight;
            centerX = sphereWidth / 2;
            centerY = sphereHeight / 2;
            radius = Math.min(sphereWidth, sphereHeight) * 0.38;
        }
        resizeSphere();
        window.addEventListener('resize', resizeSphere);

        const numPoints = 300;
        const points = [];

        for (let i = 0; i < numPoints; i++) {
            const phi = Math.acos(1 - 2 * (i + 0.5) / numPoints);
            const theta = Math.PI * (1 + Math.sqrt(5)) * i;
            const t = (i + 1) / numPoints;

            points.push({ phi, theta, t, color: getColor(t), size: 3 + Math.random() * 2 });
        }

        let time = 0;
        const cycleDuration = 10000;

        function drawCurve(progress) {
            const w = curveCanvas.width, h = curveCanvas.height;
            const padding = 30, graphW = w - padding * 2, graphH = h - padding * 2;

            curveCtx.fillStyle = '#0a0a0f';
            curveCtx.fillRect(0, 0, w, h);

            // Baseline
            curveCtx.strokeStyle = '#333';
            curveCtx.setLineDash([5, 5]);
            curveCtx.beginPath();
            curveCtx.moveTo(padding, h - padding - 0.5 * graphH);
            curveCtx.lineTo(w - padding, h - padding - 0.5 * graphH);
            curveCtx.stroke();
            curveCtx.setLineDash([]);

            curveCtx.lineWidth = 3;
            let prevX = padding, prevY = h - padding - jCurve(0) * graphH;

            for (let t = 0; t <= 1; t += 0.005) {
                const x = padding + t * graphW;
                const y = h - padding - jCurve(t) * graphH;

                curveCtx.beginPath();
                curveCtx.moveTo(prevX, prevY);
                curveCtx.lineTo(x, y);
                curveCtx.strokeStyle = getColor(t);
                curveCtx.stroke();

                prevX = x; prevY = y;
            }

            const markerX = padding + progress * graphW;
            const markerY = h - padding - jCurve(progress) * graphH;

            curveCtx.beginPath();
            curveCtx.arc(markerX, markerY, 6, 0, Math.PI * 2);
            curveCtx.fillStyle = '#fff';
            curveCtx.fill();

            curveCtx.strokeStyle = '#333';
            curveCtx.lineWidth = 1;
            curveCtx.beginPath();
            curveCtx.moveTo(padding, padding);
            curveCtx.lineTo(padding, h - padding);
            curveCtx.lineTo(w - padding, h - padding);
            curveCtx.stroke();
        }

        function drawSphere(progress) {
            sphereCtx.fillStyle = '#0a0a0f';
            sphereCtx.fillRect(0, 0, sphereWidth, sphereHeight);

            const rotationY = time * 0.2;
            const rotationX = 0.3;

            // For J-curve: brightness = jCurve value
            const projected = points.map(p => {
                let x = Math.sin(p.phi) * Math.cos(p.theta + rotationY);
                let y = Math.cos(p.phi);
                let z = Math.sin(p.phi) * Math.sin(p.theta + rotationY);

                const y2 = y * Math.cos(rotationX) - z * Math.sin(rotationX);
                const z2 = y * Math.sin(rotationX) + z * Math.cos(rotationX);
                y = y2; z = z2;

                const activated = progress >= p.t;
                const brightness = jCurve(p.t);

                return { x, y, z, activated, color: p.color, size: p.size, brightness };
            });

            projected.sort((a, b) => a.z - b.z);

            sphereCtx.beginPath();
            sphereCtx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            sphereCtx.strokeStyle = 'rgba(255,255,255,0.05)';
            sphereCtx.lineWidth = 1;
            sphereCtx.stroke();

            projected.forEach(p => {
                const scale = (p.z + 1.5) / 2.5;
                const screenX = centerX + p.x * radius;
                const screenY = centerY + p.y * radius;
                const size = p.size * scale * (0.5 + p.brightness * 0.8);

                sphereCtx.beginPath();
                sphereCtx.arc(screenX, screenY, Math.max(size, 1), 0, Math.PI * 2);

                if (p.activated) {
                    sphereCtx.fillStyle = p.color;
                    if (p.z > 0.3 && p.brightness > 0.5) {
                        sphereCtx.shadowColor = p.color;
                        sphereCtx.shadowBlur = 10 * p.brightness;
                    }
                } else {
                    sphereCtx.fillStyle = `rgba(40, 40, 40, ${0.2 + scale * 0.2})`;
                    sphereCtx.shadowBlur = 0;
                }

                sphereCtx.fill();
                sphereCtx.shadowBlur = 0;
            });
        }

        function animate() {
            const elapsed = (performance.now() % cycleDuration) / cycleDuration;

            drawCurve(elapsed);
            drawSphere(elapsed);
            progressFill.style.width = (elapsed * 100) + '%';

            time += 0.016;
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
