<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parasite vs Host</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #0a0a0a;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
        }
        h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #888;
            font-size: 14px;
            margin-bottom: 30px;
            text-align: center;
            max-width: 600px;
        }
        #canvas {
            background: #0a0a0a;
            border-radius: 8px;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        button {
            padding: 12px 28px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .play-btn {
            background: linear-gradient(90deg, #3B82F6, #EF4444);
            color: white;
        }
        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        .reset-btn {
            background: #333;
            color: #aaa;
        }
        .reset-btn:hover {
            background: #444;
            color: #fff;
        }
        .camera-toggle {
            background: #1a1a1a;
            border: 1px solid #444;
            color: #888;
        }
        .camera-toggle.active {
            background: #F59E0B;
            border-color: #F59E0B;
            color: #000;
        }
        .stats {
            display: flex;
            gap: 50px;
            margin: 20px 0;
            font-size: 13px;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .stat-label {
            color: #666;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-value.host { color: #3B82F6; }
        .stat-value.parasite { color: #EF4444; }
        .stat-value.coverage { color: #F59E0B; }
        .info {
            max-width: 700px;
            text-align: center;
            margin-top: 30px;
            padding: 20px 25px;
            background: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .info p {
            font-size: 13px;
            color: #888;
            line-height: 1.6;
        }
        .info strong {
            color: #aaa;
        }
    </style>
</head>
<body>
    <h1>Parasite vs Host</h1>
    <p class="subtitle">America is huge and healthy. The parasites are tiny but loud. The camera only shows what's sensational.</p>

    <div class="controls">
        <button class="play-btn" id="playBtn">â–¶ Start</button>
        <button class="camera-toggle" id="cameraBtn">ðŸ“º Media Camera: OFF</button>
        <button class="reset-btn" id="resetBtn">Reset</button>
    </div>

    <svg id="canvas" width="900" height="500"></svg>

    <div class="stats">
        <div class="stat">
            <div class="stat-value host" id="hostHealth">100%</div>
            <div class="stat-label">Host Strength</div>
        </div>
        <div class="stat">
            <div class="stat-value parasite" id="parasiteSize">5%</div>
            <div class="stat-label">Parasite Visibility</div>
        </div>
        <div class="stat">
            <div class="stat-value coverage" id="coverage">Balanced</div>
            <div class="stat-label">Media Focus</div>
        </div>
    </div>

    <div class="info">
        <p><strong>What you're seeing:</strong> The blue circle is America â€” 330 million people going about their lives. The small red dots are parasites â€” loud, pulsing, demanding attention. Toggle the "Media Camera" to see what gets broadcast: suddenly the parasites look like they're taking over, even though they're still tiny.</p>
    </div>

    <script>
        const width = 900;
        const height = 500;
        const centerX = width / 2;
        const centerY = height / 2;

        const svg = d3.select('#canvas');
        const playBtn = document.getElementById('playBtn');
        const resetBtn = document.getElementById('resetBtn');
        const cameraBtn = document.getElementById('cameraBtn');

        let cameraOn = false;
        let isPlaying = false;
        let animationTimer = null;

        // The host (America)
        const hostRadius = 180;

        // Create gradient for host
        const defs = svg.append('defs');
        const gradient = defs.append('radialGradient')
            .attr('id', 'hostGradient')
            .attr('cx', '30%')
            .attr('cy', '30%');
        gradient.append('stop').attr('offset', '0%').attr('stop-color', '#60A5FA');
        gradient.append('stop').attr('offset', '100%').attr('stop-color', '#1E40AF');

        // Draw host
        const host = svg.append('circle')
            .attr('cx', centerX)
            .attr('cy', centerY)
            .attr('r', hostRadius)
            .attr('fill', 'url(#hostGradient)')
            .attr('opacity', 0.8);

        // Host label
        const hostLabel = svg.append('text')
            .attr('x', centerX)
            .attr('y', centerY)
            .attr('text-anchor', 'middle')
            .attr('fill', 'white')
            .attr('font-size', '24px')
            .attr('font-weight', 'bold')
            .attr('opacity', 0.6)
            .text('330 MILLION');

        const hostSublabel = svg.append('text')
            .attr('x', centerX)
            .attr('y', centerY + 25)
            .attr('text-anchor', 'middle')
            .attr('fill', 'white')
            .attr('font-size', '14px')
            .attr('opacity', 0.4)
            .text('Living their lives');

        // Parasites
        const parasiteData = [
            { angle: 0.3, distance: hostRadius + 30 },
            { angle: 1.2, distance: hostRadius + 25 },
            { angle: 2.1, distance: hostRadius + 35 },
            { angle: 3.0, distance: hostRadius + 28 },
            { angle: 4.2, distance: hostRadius + 32 },
            { angle: 5.1, distance: hostRadius + 27 }
        ];

        parasiteData.forEach((p, i) => {
            p.id = i;
            p.x = centerX + Math.cos(p.angle) * p.distance;
            p.y = centerY + Math.sin(p.angle) * p.distance;
            p.baseRadius = 8;
            p.radius = 8;
            p.pulsePhase = Math.random() * Math.PI * 2;
        });

        // Glow filter for parasites
        const filter = defs.append('filter')
            .attr('id', 'glow')
            .attr('x', '-50%')
            .attr('y', '-50%')
            .attr('width', '200%')
            .attr('height', '200%');
        filter.append('feGaussianBlur')
            .attr('stdDeviation', '3')
            .attr('result', 'coloredBlur');
        const feMerge = filter.append('feMerge');
        feMerge.append('feMergeNode').attr('in', 'coloredBlur');
        feMerge.append('feMergeNode').attr('in', 'SourceGraphic');

        // Draw parasites
        const parasites = svg.selectAll('.parasite')
            .data(parasiteData)
            .enter()
            .append('circle')
            .attr('class', 'parasite')
            .attr('cx', d => d.x)
            .attr('cy', d => d.y)
            .attr('r', d => d.radius)
            .attr('fill', '#EF4444')
            .attr('filter', 'url(#glow)')
            .attr('opacity', 0.9);

        // Camera viewport (hidden by default)
        const cameraFrame = svg.append('rect')
            .attr('class', 'camera-frame')
            .attr('x', 0)
            .attr('y', 0)
            .attr('width', width)
            .attr('height', height)
            .attr('fill', 'none')
            .attr('stroke', '#F59E0B')
            .attr('stroke-width', 4)
            .attr('stroke-dasharray', '10,5')
            .attr('opacity', 0);

        // Camera focus circle
        const cameraFocus = svg.append('circle')
            .attr('cx', centerX)
            .attr('cy', centerY)
            .attr('r', 60)
            .attr('fill', 'none')
            .attr('stroke', '#F59E0B')
            .attr('stroke-width', 2)
            .attr('opacity', 0);

        // "LIVE" indicator
        const liveIndicator = svg.append('g')
            .attr('opacity', 0);

        liveIndicator.append('rect')
            .attr('x', 30)
            .attr('y', 30)
            .attr('width', 60)
            .attr('height', 25)
            .attr('rx', 4)
            .attr('fill', '#EF4444');

        liveIndicator.append('text')
            .attr('x', 60)
            .attr('y', 47)
            .attr('text-anchor', 'middle')
            .attr('fill', 'white')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .text('LIVE');

        let tick = 0;
        let currentParasiteIndex = 0;

        function animate() {
            tick++;

            // Pulse parasites
            parasiteData.forEach((p, i) => {
                p.pulsePhase += 0.15;
                p.radius = p.baseRadius + Math.sin(p.pulsePhase) * 4;

                // Make them louder over time
                if (tick % 30 === 0) {
                    p.baseRadius = Math.min(18, p.baseRadius + 0.3);
                }
            });

            parasites
                .attr('r', d => d.radius)
                .attr('opacity', d => 0.7 + Math.sin(d.pulsePhase) * 0.3);

            // If camera is on, focus on different parasites
            if (cameraOn) {
                if (tick % 40 === 0) {
                    currentParasiteIndex = (currentParasiteIndex + 1) % parasiteData.length;
                }

                const target = parasiteData[currentParasiteIndex];

                cameraFocus
                    .transition()
                    .duration(300)
                    .attr('cx', target.x)
                    .attr('cy', target.y)
                    .attr('r', 80 + Math.sin(tick * 0.1) * 10);
            }

            updateStats();
            animationTimer = requestAnimationFrame(animate);
        }

        function updateStats() {
            const avgParasiteRadius = parasiteData.reduce((sum, p) => sum + p.baseRadius, 0) / parasiteData.length;
            const parasiteVisibility = Math.round((avgParasiteRadius / 18) * 100);

            document.getElementById('hostHealth').textContent = '100%';
            document.getElementById('parasiteSize').textContent = parasiteVisibility + '%';
            document.getElementById('coverage').textContent = cameraOn ? 'Parasites' : 'Balanced';
        }

        function toggleCamera() {
            cameraOn = !cameraOn;

            if (cameraOn) {
                cameraBtn.classList.add('active');
                cameraBtn.textContent = 'ðŸ“º Media Camera: ON';

                // Zoom effect - host shrinks, parasites appear larger
                host.transition().duration(500)
                    .attr('r', hostRadius * 0.4)
                    .attr('opacity', 0.3);

                hostLabel.transition().duration(500).attr('opacity', 0);
                hostSublabel.transition().duration(500).attr('opacity', 0);

                parasites.transition().duration(500)
                    .attr('r', d => d.radius * 2.5);

                cameraFrame.transition().duration(500).attr('opacity', 1);
                cameraFocus.transition().duration(500).attr('opacity', 1);
                liveIndicator.transition().duration(500).attr('opacity', 1);

            } else {
                cameraBtn.classList.remove('active');
                cameraBtn.textContent = 'ðŸ“º Media Camera: OFF';

                // Zoom out - see the real picture
                host.transition().duration(500)
                    .attr('r', hostRadius)
                    .attr('opacity', 0.8);

                hostLabel.transition().duration(500).attr('opacity', 0.6);
                hostSublabel.transition().duration(500).attr('opacity', 0.4);

                parasites.transition().duration(500)
                    .attr('r', d => d.radius);

                cameraFrame.transition().duration(500).attr('opacity', 0);
                cameraFocus.transition().duration(500).attr('opacity', 0);
                liveIndicator.transition().duration(500).attr('opacity', 0);
            }

            updateStats();
        }

        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                isPlaying = false;
                cancelAnimationFrame(animationTimer);
                playBtn.textContent = 'â–¶ Resume';
            } else {
                isPlaying = true;
                playBtn.textContent = 'â¸ Pause';
                animate();
            }
        });

        cameraBtn.addEventListener('click', toggleCamera);

        function reset() {
            isPlaying = false;
            cancelAnimationFrame(animationTimer);
            tick = 0;
            cameraOn = false;

            parasiteData.forEach(p => {
                p.baseRadius = 8;
                p.radius = 8;
            });

            host.transition().duration(500)
                .attr('r', hostRadius)
                .attr('opacity', 0.8);

            hostLabel.transition().duration(500).attr('opacity', 0.6);
            hostSublabel.transition().duration(500).attr('opacity', 0.4);

            parasites.transition().duration(500)
                .attr('r', 8);

            cameraFrame.attr('opacity', 0);
            cameraFocus.attr('opacity', 0);
            liveIndicator.attr('opacity', 0);

            cameraBtn.classList.remove('active');
            cameraBtn.textContent = 'ðŸ“º Media Camera: OFF';
            playBtn.textContent = 'â–¶ Start';

            updateStats();
        }

        resetBtn.addEventListener('click', reset);
        updateStats();
    </script>
</body>
</html>
