<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Player Ages by Position - Bubbles</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #ffffff;
            margin: 0 0 5px 0;
            font-size: 18px;
        }
        .description {
            color: #aaaaaa;
            margin: 0 0 10px 0;
            text-align: center;
            font-size: 12px;
            max-width: 1200px;
            line-height: 1.5;
        }
        #vis {
            margin: 0 auto;
        }
        svg {
            background-color: #0a0a0a;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .age-label {
            fill: #666;
            font-size: 10px;
            font-family: Arial, sans-serif;
        }
        .position-label {
            fill: #aaa;
            font-size: 11px;
            font-family: Arial, sans-serif;
            font-weight: bold;
        }
        .position-count {
            fill: #555;
            font-size: 9px;
            font-family: Arial, sans-serif;
        }
        .cell-bubble {
            stroke: rgba(255,255,255,0.3);
            stroke-width: 1px;
            opacity: 0.85;
        }
        .cell-label {
            fill: #fff;
            font-size: 9px;
            font-family: Arial, sans-serif;
            font-weight: bold;
            pointer-events: none;
        }
        .legend {
            color: #aaaaaa;
            font-size: 11px;
            margin-top: 10px;
            text-align: center;
        }
        .grid-line {
            stroke: #222;
            stroke-width: 1px;
        }
    </style>
</head>
<body>
    <h1>NFL Player Ages by Position (2025)</h1>
    <p class="description">
        Each bubble = one age/position combination. Size = number of players. Label = count.
    </p>
    <div id="vis"></div>
    <div class="legend">
        Bubble size = player count | Green = young | Blue = prime | Red = veteran
    </div>

    <script>
        // Position data with age breakdowns (from ESPN scrape, Nov 2025)
        const positionData = {
            "QB": {"22":4,"23":6,"24":13,"25":14,"26":10,"27":13,"28":8,"29":7,"30":10,"31":3,"32":7,"33":3,"34":1,"35":2,"36":2,"37":3,"38":1,"39":1,"40":1,"41":1},
            "RB": {"21":8,"22":15,"23":21,"24":24,"25":28,"26":36,"27":16,"28":11,"29":10,"30":6,"31":2,"32":1,"33":1},
            "WR": {"21":2,"22":21,"23":43,"24":59,"25":45,"26":33,"27":22,"28":27,"29":22,"30":13,"31":8,"32":10,"33":3,"35":1},
            "TE": {"21":3,"22":10,"23":12,"24":17,"25":31,"26":29,"27":18,"28":16,"29":8,"30":11,"31":7,"32":4,"33":3,"35":1,"36":1,"41":1},
            "OT": {"21":4,"22":9,"23":22,"24":29,"25":28,"26":29,"27":28,"28":16,"29":12,"30":11,"31":12,"32":1,"33":5,"34":2,"35":2,"36":1,"37":1},
            "G": {"21":2,"22":6,"23":11,"24":15,"25":26,"26":32,"27":21,"28":20,"29":12,"30":3,"31":5,"32":3,"33":2,"34":2,"35":2},
            "C": {"22":3,"23":8,"24":18,"25":9,"26":12,"27":9,"28":8,"29":6,"30":5,"31":1,"32":2,"33":2},
            "DE": {"21":1,"22":9,"23":12,"24":15,"25":27,"26":20,"27":21,"28":15,"29":8,"30":12,"31":7,"32":5,"33":2,"34":1,"35":1,"36":1,"37":1},
            "DT": {"21":2,"22":12,"23":21,"24":41,"25":25,"26":21,"27":22,"28":20,"29":13,"30":12,"31":15,"32":9,"33":5,"34":2,"36":2,"39":1},
            "LB": {"21":5,"22":20,"23":36,"24":44,"25":57,"26":54,"27":40,"28":22,"29":25,"30":14,"31":12,"32":3,"33":2,"34":2,"35":2,"36":3},
            "CB": {"21":3,"22":14,"23":39,"24":46,"25":60,"26":37,"27":27,"28":21,"29":19,"30":14,"31":5,"32":5,"34":1,"35":1},
            "S": {"21":2,"22":12,"23":17,"24":32,"25":33,"26":26,"27":22,"28":15,"29":16,"30":10,"31":3,"32":4,"33":1,"34":2,"36":1},
            "PK": {"22":2,"23":3,"24":4,"25":3,"26":7,"27":2,"28":1,"29":2,"30":8,"31":4,"34":4,"38":1,"41":2},
            "P": {"23":1,"24":3,"25":2,"26":2,"27":4,"28":3,"29":5,"30":3,"31":3,"32":1,"33":1,"35":3,"37":1,"39":1},
            "LS": {"23":2,"24":1,"25":1,"26":1,"27":2,"28":2,"29":3,"30":2,"31":4,"32":3,"33":3,"35":3,"36":2,"38":2,"39":3}
        };

        // Order positions logically: Offense, Defense, Special Teams
        const positionOrder = ["QB", "RB", "WR", "TE", "OT", "G", "C", "DE", "DT", "LB", "CB", "S", "PK", "P", "LS"];

        // All ages from 21 to 41
        const ages = [];
        for (let a = 41; a >= 21; a--) ages.push(a);

        // Layout
        const width = 1200;
        const height = 800;
        const paddingTop = 50;
        const paddingBottom = 20;
        const paddingLeft = 35;
        const paddingRight = 20;

        const numPositions = positionOrder.length;
        const numAges = ages.length;

        const colWidth = (width - paddingLeft - paddingRight) / numPositions;
        const rowHeight = (height - paddingTop - paddingBottom) / numAges;

        // Find max count for radius scaling
        let maxCount = 0;
        positionOrder.forEach(pos => {
            Object.values(positionData[pos]).forEach(count => {
                if (count > maxCount) maxCount = count;
            });
        });

        // Radius scale - sqrt for area perception
        const maxRadius = Math.min(colWidth, rowHeight) / 2 - 2;
        const radiusScale = d3.scaleSqrt()
            .domain([0, maxCount])
            .range([0, maxRadius]);

        // Color scale
        const colorScale = d3.scaleLinear()
            .domain([21, 28, 41])
            .range(['#10B981', '#3B82F6', '#EF4444']);

        // Create SVG
        const svg = d3.select('#vis')
            .append('svg')
            .attr('width', width)
            .attr('height', height);

        // Draw vertical grid lines between positions
        positionOrder.forEach((_, i) => {
            if (i > 0) {
                svg.append('line')
                    .attr('class', 'grid-line')
                    .attr('x1', paddingLeft + i * colWidth)
                    .attr('y1', paddingTop - 15)
                    .attr('x2', paddingLeft + i * colWidth)
                    .attr('y2', height - paddingBottom);
            }
        });

        // Draw position headers
        positionOrder.forEach((pos, i) => {
            const x = paddingLeft + i * colWidth + colWidth / 2;

            // Position name
            svg.append('text')
                .attr('class', 'position-label')
                .attr('x', x)
                .attr('y', 20)
                .attr('text-anchor', 'middle')
                .text(pos);

            // Player count
            const total = Object.values(positionData[pos]).reduce((a, b) => a + b, 0);
            svg.append('text')
                .attr('class', 'position-count')
                .attr('x', x)
                .attr('y', 32)
                .attr('text-anchor', 'middle')
                .text(`(${total})`);
        });

        // Draw age labels on left
        ages.forEach((age, i) => {
            const y = paddingTop + i * rowHeight + rowHeight / 2;
            svg.append('text')
                .attr('class', 'age-label')
                .attr('x', paddingLeft - 5)
                .attr('y', y + 3)
                .attr('text-anchor', 'end')
                .text(age);
        });

        // Draw bubbles for each position/age combination
        positionOrder.forEach((pos, colIndex) => {
            const colCenterX = paddingLeft + colIndex * colWidth + colWidth / 2;

            ages.forEach((age, rowIndex) => {
                const count = positionData[pos][age] || 0;
                if (count === 0) return;

                const rowCenterY = paddingTop + rowIndex * rowHeight + rowHeight / 2;
                const radius = radiusScale(count);

                // Draw bubble
                svg.append('circle')
                    .attr('class', 'cell-bubble')
                    .attr('cx', colCenterX)
                    .attr('cy', rowCenterY)
                    .attr('r', radius)
                    .attr('fill', colorScale(age));

                // Draw count label (only if bubble is big enough)
                if (radius > 8) {
                    svg.append('text')
                        .attr('class', 'cell-label')
                        .attr('x', colCenterX)
                        .attr('y', rowCenterY + 3)
                        .attr('text-anchor', 'middle')
                        .style('font-size', Math.min(radius * 0.8, 12) + 'px')
                        .text(count);
                }
            });
        });
    </script>
</body>
</html>
