<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Women Entering the Workforce</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            background: #0a0a0a;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
        }

        @media (min-width: 1200px) {
            body { padding-right: 320px; }
        }

        .back-link {
            position: fixed;
            top: 15px;
            left: 20px;
            color: #666;
            text-decoration: none;
            font-size: 13px;
            z-index: 100;
        }
        .back-link:hover { color: #fff; }

        .page {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 15px 30px;
        }

        header {
            text-align: center;
            padding: 10px 0;
            flex-shrink: 0;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #EC4899, #8B5CF6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { color: #666; font-size: 13px; }

        .main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            min-height: 0;
        }

        .scenario {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            flex: 1;
            transition: flex 0.3s ease;
        }
        .scenario.fear {
            flex: 1;
        }
        .scenario.reality {
            flex: 1;
        }

        .scenario-header {
            text-align: center;
            margin-bottom: 8px;
            flex-shrink: 0;
        }
        .scenario-title {
            font-size: 16px;
            font-weight: 600;
        }
        .scenario-subtitle {
            font-size: 11px;
            color: #666;
        }

        .chart-container {
            flex: 1;
            width: 100%;
            min-height: 0;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            padding: 8px 0;
            flex-shrink: 0;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        .stat-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
        }

        .scenario.fear .scenario-title { color: #EF4444; }
        .scenario.reality .scenario-title { color: #22C55E; }
        .scenario.fear .stat-value { color: #EF4444; }
        .scenario.reality .stat-value { color: #22C55E; }

        .divider {
            width: 1px;
            background: #333;
            align-self: stretch;
            margin: 40px 0;
        }

        .footer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            padding: 10px 0;
            flex-shrink: 0;
        }

        .play-btn {
            padding: 10px 25px;
            border-radius: 6px;
            background: linear-gradient(135deg, #EC4899, #8B5CF6);
            border: none;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .play-btn:hover { transform: scale(1.05); }

        .year-indicator {
            font-size: 18px;
            font-weight: bold;
            color: #EC4899;
        }

        .legend {
            display: flex;
            gap: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #888;
        }
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100vh;
            background: #0f0f14;
            border-left: 1px solid #222;
            overflow-y: auto;
            padding: 25px;
            z-index: 50;
            display: none;
        }

        @media (min-width: 1200px) {
            .sidebar { display: block; }
        }

        .sidebar h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #EC4899;
        }

        .sidebar .source {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid #222;
            font-size: 12px;
            color: #666;
        }

        .sidebar .source a {
            color: #3B82F6;
            text-decoration: none;
        }

        .sidebar .source a:hover {
            text-decoration: underline;
        }

        .sidebar .source strong {
            color: #999;
        }

        .sidebar p {
            color: #888;
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .sidebar strong {
            color: #fff;
        }

        .sidebar em {
            color: #EC4899;
            font-style: normal;
        }

        .sidebar .stat-box {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .sidebar .stat-box .label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .sidebar .stat-box .numbers {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .sidebar .stat-box .year {
            color: #666;
        }

        .sidebar .stat-box .value {
            font-weight: 600;
        }

        .sidebar .stat-box .value.blue { color: #3B82F6; }
        .sidebar .stat-box .value.pink { color: #EC4899; }
        .sidebar .stat-box .value.green { color: #22C55E; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back</a>

    <div class="page">
        <header>
            <h1>Women Entering the Workforce</h1>
            <p class="subtitle">What men feared vs. what actually happened</p>
            <button class="play-btn" id="playBtn" style="margin-top: 15px;">Play 1950 → 2020</button>
        </header>

        <div class="main">
            <div class="scenario fear">
                <div class="scenario-header">
                    <div class="scenario-title">What Men Feared</div>
                    <div class="scenario-subtitle">Zero-sum: Women replace men</div>
                </div>
                <div class="chart-container">
                    <svg id="chart-fear"></svg>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="fear-men">100</div>
                        <div class="stat-label">Men</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="fear-women">0</div>
                        <div class="stat-label">Women</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="fear-total">100</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="scenario reality">
                <div class="scenario-header">
                    <div class="scenario-title">What Actually Happened</div>
                    <div class="scenario-subtitle">Positive-sum: The pie grew</div>
                </div>
                <div class="chart-container">
                    <svg id="chart-reality"></svg>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="reality-men">100</div>
                        <div class="stat-label">Men</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="reality-women">0</div>
                        <div class="stat-label">Women</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="reality-total">100</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #3B82F6"></div>
                    Men
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #EC4899"></div>
                    Women
                </div>
            </div>
            <div class="year-indicator" id="yearDisplay">1950</div>
        </div>
    </div>

    <div class="sidebar">
        <h2>The Data</h2>

        <div class="stat-box">
            <div class="label">1950 Labor Force</div>
            <div class="numbers">
                <span class="year">Men</span>
                <span class="value blue">~44 million</span>
            </div>
            <div class="numbers">
                <span class="year">Women</span>
                <span class="value pink">18.4 million</span>
            </div>
            <div class="numbers">
                <span class="year">Total</span>
                <span class="value">~62 million</span>
            </div>
        </div>

        <div class="stat-box">
            <div class="label">2000 Labor Force</div>
            <div class="numbers">
                <span class="year">Men</span>
                <span class="value blue">~77 million</span>
            </div>
            <div class="numbers">
                <span class="year">Women</span>
                <span class="value pink">66.3 million</span>
            </div>
            <div class="numbers">
                <span class="year">Total</span>
                <span class="value green">~143 million</span>
            </div>
        </div>

        <p>The economy <em>more than doubled</em>. Men's employment grew from ~44M to ~77M while women's grew from 18M to 66M.</p>

        <p>Women entering the workforce was <strong>not zero-sum</strong>. The pie grew.</p>

        <h2 style="margin-top: 20px;">Sources</h2>

        <div class="source">
            <a href="https://www.bls.gov/opub/mlr/2002/05/art2full.pdf" target="_blank">
                <strong>A Century of Change: The U.S. Labor Force, 1950–2050</strong>
            </a>
            <br>U.S. Bureau of Labor Statistics (2002)
        </div>

        <div class="source">
            <a href="https://www.brookings.edu/articles/the-history-of-womens-work-and-wages-and-how-it-has-created-success-for-us-all/" target="_blank">
                <strong>The History of Women's Work and Wages</strong>
            </a>
            <br>Janet Yellen, Brookings Institution
        </div>

        <div class="source">
            <a href="https://www.bls.gov/opub/ted/2007/jan/wk2/art03.htm" target="_blank">
                <strong>Changes in Men's and Women's Labor Force Participation Rates</strong>
            </a>
            <br>U.S. Bureau of Labor Statistics
        </div>
    </div>

    <script>
        const MALE_COLOR = '#3B82F6';
        const FEMALE_COLOR = '#EC4899';
        const START_YEAR = 1950;
        const END_YEAR = 2020;
        const RADIUS = 8;

        // Store persistent data with positions
        let fearDataMap = new Map();
        let realityDataMap = new Map();

        function createOrUpdateData(dataMap, menCount, womenCount, width, height) {
            const newMap = new Map();

            // Add/keep men
            for (let i = 0; i < menCount; i++) {
                const id = `male-${i}`;
                if (dataMap.has(id)) {
                    newMap.set(id, dataMap.get(id));
                } else {
                    // New male - enter from left
                    newMap.set(id, {
                        id,
                        gender: 'male',
                        r: RADIUS,
                        x: RADIUS + Math.random() * 30,
                        y: height / 2 + (Math.random() - 0.5) * height * 0.5
                    });
                }
            }

            // Add/keep women
            for (let i = 0; i < womenCount; i++) {
                const id = `female-${i}`;
                if (dataMap.has(id)) {
                    newMap.set(id, dataMap.get(id));
                } else {
                    // New woman - enter from right
                    newMap.set(id, {
                        id,
                        gender: 'female',
                        r: RADIUS,
                        x: width - RADIUS - Math.random() * 30,
                        y: height / 2 + (Math.random() - 0.5) * height * 0.5
                    });
                }
            }

            return newMap;
        }

        function runSimulation(svg, dataMap, width, height) {
            const data = Array.from(dataMap.values());

            const simulation = d3.forceSimulation(data)
                .force('charge', d3.forceManyBody().strength(-3))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(d => d.r + 2).strength(1))
                .force('x', d3.forceX(width / 2).strength(0.08))
                .force('y', d3.forceY(height / 2).strength(0.08))
                .alphaDecay(0.02)
                .velocityDecay(0.3);

            // Update circles
            const bubbles = svg.selectAll('circle')
                .data(data, d => d.id);

            // Remove exiting
            bubbles.exit()
                .transition()
                .duration(300)
                .attr('r', 0)
                .attr('opacity', 0)
                .remove();

            // Add entering
            const entering = bubbles.enter()
                .append('circle')
                .attr('r', 0)
                .attr('cx', d => d.x)
                .attr('cy', d => d.y)
                .attr('fill', d => d.gender === 'male' ? MALE_COLOR : FEMALE_COLOR)
                .attr('opacity', 0.85);

            entering.transition()
                .duration(300)
                .attr('r', d => d.r);

            // Merge for updates
            const allBubbles = entering.merge(bubbles);

            simulation.on('tick', () => {
                allBubbles
                    .attr('cx', d => {
                        d.x = Math.max(d.r + 2, Math.min(width - d.r - 2, d.x));
                        return d.x;
                    })
                    .attr('cy', d => {
                        d.y = Math.max(d.r + 2, Math.min(height - d.r - 2, d.y));
                        return d.y;
                    });
            });

            return simulation;
        }

        const fearScenario = document.querySelector('.scenario.fear');
        const realityScenario = document.querySelector('.scenario.reality');
        const fearSvg = d3.select('#chart-fear');
        const realitySvg = d3.select('#chart-reality');

        let currentYear = START_YEAR;
        let animating = false;
        let animationInterval = null;
        let fearSim = null;
        let realitySim = null;

        function getStateForYear(year) {
            const progress = (year - START_YEAR) / (END_YEAR - START_YEAR);
            const fearMen = Math.round(100 - 50 * progress);
            const fearWomen = Math.round(50 * progress);
            const realityMen = Math.round(100 + 5 * progress);
            const realityWomen = Math.round(75 * progress);
            return { fearMen, fearWomen, realityMen, realityWomen };
        }

        function updateForYear(year) {
            const state = getStateForYear(year);

            // Calculate flex ratio: reality grows to ~1.8x at end
            const fearTotal = state.fearMen + state.fearWomen;
            const realityTotal = state.realityMen + state.realityWomen;
            const ratio = realityTotal / fearTotal;

            // Update flex to make right side grow
            fearScenario.style.flex = '1';
            realityScenario.style.flex = String(ratio);

            // Wait a tick for layout to update, then update simulations
            requestAnimationFrame(() => {
                const fearRect = fearSvg.node().parentElement.getBoundingClientRect();
                const realityRect = realitySvg.node().parentElement.getBoundingClientRect();

                // Stop old simulations
                if (fearSim) fearSim.stop();
                if (realitySim) realitySim.stop();

                // Update data maps (preserves positions of existing nodes)
                fearDataMap = createOrUpdateData(fearDataMap, state.fearMen, state.fearWomen, fearRect.width, fearRect.height);
                realityDataMap = createOrUpdateData(realityDataMap, state.realityMen, state.realityWomen, realityRect.width, realityRect.height);

                // Run new simulations
                fearSim = runSimulation(fearSvg, fearDataMap, fearRect.width, fearRect.height);
                realitySim = runSimulation(realitySvg, realityDataMap, realityRect.width, realityRect.height);
            });

            // Update stats
            document.getElementById('fear-men').textContent = state.fearMen;
            document.getElementById('fear-women').textContent = state.fearWomen;
            document.getElementById('fear-total').textContent = state.fearMen + state.fearWomen;

            document.getElementById('reality-men').textContent = state.realityMen;
            document.getElementById('reality-women').textContent = state.realityWomen;
            document.getElementById('reality-total').textContent = state.realityMen + state.realityWomen;

            document.getElementById('yearDisplay').textContent = year;
        }

        document.getElementById('playBtn').addEventListener('click', function() {
            if (animating) {
                clearInterval(animationInterval);
                animating = false;
                this.textContent = 'Play 1950 → 2020';
                return;
            }

            animating = true;
            this.textContent = 'Pause';

            if (currentYear >= END_YEAR) {
                currentYear = START_YEAR;
                // Reset data maps for replay
                fearDataMap = new Map();
                realityDataMap = new Map();
            }

            animationInterval = setInterval(() => {
                currentYear += 2;
                if (currentYear > END_YEAR) {
                    currentYear = END_YEAR;
                    clearInterval(animationInterval);
                    animating = false;
                    document.getElementById('playBtn').textContent = 'Replay';
                }
                updateForYear(currentYear);
            }, 150);
        });

        // Initial render after layout settles
        setTimeout(() => updateForYear(START_YEAR), 100);
    </script>
</body>
</html>
